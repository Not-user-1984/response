# Pydantic

## 1. –ß—Ç–æ —Ç–∞–∫–æ–µ Pydantic –∏ –¥–ª—è —á–µ–≥–æ –æ–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è?
Pydantic ‚Äî –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –∏ —Ä–∞–±–æ—Ç—ã —Å –º–æ–¥–µ–ª—è–º–∏ –≤ Python. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞, —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–∞–Ω–Ω—ã—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, JSON, –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π, –∑–∞–ø—Ä–æ—Å–æ–≤/–æ—Ç–≤–µ—Ç–æ–≤ API). –û—Å–Ω–æ–≤–∞–Ω –Ω–∞ –∞–Ω–Ω–æ—Ç–∞—Ü–∏—è—Ö —Ç–∏–ø–æ–≤.

## 2. –ö–∞–∫ —Å–æ–∑–¥–∞—Ç—å –±–∞–∑–æ–≤—É—é –º–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Pydantic?
–ò—Å–ø–æ–ª—å–∑—É–π –∫–ª–∞—Å—Å `BaseModel`. –ü—Ä–∏–º–µ—Ä:

```python
from pydantic import BaseModel

class User(BaseModel):
    id: int
    name: str
    email: str
```

–¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å –æ–±—ä–µ–∫—Ç—ã `User` —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Ç–∏–ø–æ–≤.

## 3. –ö–∞–∫ Pydantic –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö?
Pydantic –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–π. –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Ç–∏–ø–∞–º, –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –∏—Å–∫–ª—é—á–µ–Ω–∏–µ¬†`ValidationError`. –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å –∫–∞—Å—Ç–æ–º–Ω—ã–µ –≤–∞–ª–∏–¥–∞—Ç–æ—Ä—ã —á–µ—Ä–µ–∑ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä¬†`@validator`.
## 4. –ß–µ–º –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è BaseModel –æ—Ç dataclass –≤ Pydantic?
–í–æ—Ç —Ç–∞–±–ª–∏—Ü–∞ —Å –æ—Å–Ω–æ–≤–Ω—ã–º–∏ —Ä–∞–∑–ª–∏—á–∏—è–º–∏ –º–µ–∂–¥—É `BaseModel`, `Dataclass` –∏ –≥–∏–±—Ä–∏–¥–Ω—ã–º –ø–æ–¥—Ö–æ–¥–æ–º `Pydantic + Dataclass`:

| **–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞**            | **BaseModel**                          | **Dataclass**                     | **Pydantic + Dataclass**          |
|-------------------------------|----------------------------------------|-----------------------------------|-----------------------------------|
| **–û—Å–Ω–æ–≤–Ω–∞—è —Ü–µ–ª—å**             | –í–∞–ª–∏–¥–∞—Ü–∏—è, –ø–∞—Ä—Å–∏–Ω–≥, —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è       | –£–ø—Ä–æ—â–µ–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª–∞—Å—Å–æ–≤ –¥–∞–Ω–Ω—ã—Ö | –£–ø—Ä–æ—â–µ–Ω–∏–µ + –≤–∞–ª–∏–¥–∞—Ü–∏—è             |
| **–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö**          | ‚úÖ –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è                          | ‚ùå –ù–µ—Ç (–µ—Å–ª–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Pydantic) | ‚úÖ –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è —á–µ—Ä–µ–∑ Pydantic       |
| **–°–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è (`.dict()`, `.json()`)** | ‚úÖ –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã                | ‚ùå –ù–µ—Ç                             | ‚ùå –ù–µ—Ç (—Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ Pydantic)     |
| **JSON Schema**               | ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è            | ‚ùå –ù–µ—Ç                             | ‚ùå –ù–µ—Ç (—Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ Pydantic)     |
| **–ö–∞—Å—Ç–æ–º–Ω—ã–µ –≤–∞–ª–∏–¥–∞—Ç–æ—Ä—ã**      | ‚úÖ –ß–µ—Ä–µ–∑ `@validator`                  | ‚ùå –ù–µ—Ç                             | ‚úÖ –ß–µ—Ä–µ–∑ `@validator`              |
| **–í–ª–æ–∂–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏**          | ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞                           | ‚ùå –ù–µ—Ç                             | ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞                       |
| **–°–∏–Ω—Ç–∞–∫—Å–∏—Å**                 | –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π (`class User(BaseModel)`) | –£–ø—Ä–æ—â–µ–Ω–Ω—ã–π (`@dataclass`)         | –£–ø—Ä–æ—â–µ–Ω–Ω—ã–π (`@dataclass`)         |
| **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**        | –í—ã—à–µ –Ω–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã                 | –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –Ω–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã     | –°—Ä–µ–¥–Ω–∏–µ –Ω–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã         |
| **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**             | API, –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏, —Å–ª–æ–∂–Ω—ã–µ –º–æ–¥–µ–ª–∏      | –ü—Ä–æ—Å—Ç—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –¥–∞–Ω–Ω—ã—Ö         | –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥: –ø—Ä–æ—Å—Ç–æ—Ç–∞ + –≤–∞–ª–∏–¥–∞—Ü–∏—è |

- **BaseModel**: –î–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π, —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π –∏ JSON Schema.
- **Dataclass**: –î–ª—è –ø—Ä–æ—Å—Ç—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –¥–∞–Ω–Ω—ã—Ö –±–µ–∑ –≤–∞–ª–∏–¥–∞—Ü–∏–∏.
- **Pydantic + Dataclass**: –ï—Å–ª–∏ –Ω—É–∂–µ–Ω —Å–∏–Ω—Ç–∞–∫—Å–∏—Å `dataclass`, –Ω–æ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π Pydantic.

–≠—Ç–∞ —Ç–∞–±–ª–∏—Ü–∞ –ø–æ–º–æ–∂–µ—Ç –≤—ã–±—Ä–∞—Ç—å –ø–æ–¥—Ö–æ–¥—è—â–∏–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∑–∞–¥–∞—á–∏.



## 5. –ö–∞–∫ –∑–∞–¥–∞—Ç—å —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø–æ–ª–µ–π –≤ Pydantic –º–æ–¥–µ–ª–∏?
–í Pydantic —Ç–∏–ø—ã –ø–æ–ª–µ–π –∑–∞–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ **–∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ —Ç–∏–ø–æ–≤**. –ü—Ä–∏–º–µ—Ä:

```python
from pydantic import BaseModel, EmailStr
from typing import List, Optional

class User(BaseModel):
    id: int
    name: str
    email: EmailStr
    age: Optional[int] = None
    friends: List[str] = []
```

**–ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã:**
- –ë–∞–∑–æ–≤—ã–µ —Ç–∏–ø—ã: `int`, `str`, `bool`.
- –°–ª–æ–∂–Ω—ã–µ —Ç–∏–ø—ã: `List`, `Dict`, `Optional`.
- –í–ª–æ–∂–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏.
- –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Ç–∏–ø—ã: `EmailStr`, `PositiveInt`.
- –ö–∞—Å—Ç–æ–º–Ω—ã–µ —Ç–∏–ø—ã: `constr(min_length=3)`.
- `Optional` –¥–ª—è –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π.

## 6. –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–∏–ø constr –≤ Pydantic –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–ª–∏–Ω—ã —Å—Ç—Ä–æ–∫–∏?

–ß—Ç–æ–±—ã –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –¥–ª–∏–Ω—É —Å—Ç—Ä–æ–∫–∏ –≤ Pydantic, –∏—Å–ø–æ–ª—å–∑—É–π —Ç–∏–ø `constr` (constrained string). –ü—Ä–∏–º–µ—Ä:

```python
from pydantic import BaseModel, constr

class User(BaseModel):
    username: constr(min_length=3, max_length=50)  # –°—Ç—Ä–æ–∫–∞ –æ—Ç 3 –¥–æ 50 —Å–∏–º–≤–æ–ª–æ–≤
```

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:
- `min_length`: –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ —Å—Ç—Ä–æ–∫–∏.
- `max_length`: –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ —Å—Ç—Ä–æ–∫–∏.

### –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
```python
user = User(username="abc")  # –í–∞–ª–∏–¥–Ω–æ
user = User(username="ab")   # –û—à–∏–±–∫–∞: –º–µ–Ω—å—à–µ 3 —Å–∏–º–≤–æ–ª–æ–≤
user = User(username="a" * 51)  # –û—à–∏–±–∫–∞: –±–æ–ª—å—à–µ 50 —Å–∏–º–≤–æ–ª–æ–≤
```


## 7. –ö–∞–∫ –º–æ–∂–Ω–æ –∑–∞–¥–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –ø–æ–ª–µ–π –º–æ–¥–µ–ª–∏ Pydantic?
–ß—Ç–æ–±—ã –∑–∞–¥–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –ø–æ–ª–µ–π –º–æ–¥–µ–ª–∏ Pydantic, –ø—Ä–æ—Å—Ç–æ –ø—Ä–∏—Å–≤–æ–π –∑–Ω–∞—á–µ–Ω–∏–µ –ø—Ä—è–º–æ –≤ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏. –ü—Ä–∏–º–µ—Ä:

```python
from pydantic import BaseModel

class User(BaseModel):
    name: str = "Anonymous"  # –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    age: int = 18            # –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    is_active: bool = True   # –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
```

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:
- –ï—Å–ª–∏ –ø–æ–ª–µ –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω–æ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –æ–±—ä–µ–∫—Ç–∞, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.
- –ï—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω–æ ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–µ—Ä–µ–¥–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ.

### –ü—Ä–∏–º–µ—Ä:
```python
user1 = User()  # –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
print(user1)    # name='Anonymous' age=18 is_active=True

user2 = User(name="John", age=30)  # –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã name –∏ age
print(user2)    # name='John' age=30 is_active=True
```


## 8. –ö–∞–∫ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∫–∞—Å—Ç–æ–º–Ω—ã–π –≤–∞–ª–∏–¥–∞—Ç–æ—Ä –¥–ª—è –ø–æ–ª—è –º–æ–¥–µ–ª–∏ –≤ Pydantic?
–ß—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å –∫–∞—Å—Ç–æ–º–Ω—ã–π –≤–∞–ª–∏–¥–∞—Ç–æ—Ä –¥–ª—è –ø–æ–ª—è –º–æ–¥–µ–ª–∏ –≤ Pydantic, –∏—Å–ø–æ–ª—å–∑—É–π –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä `@validator`. –ü—Ä–∏–º–µ—Ä:

```python
from pydantic import BaseModel, validator

class User(BaseModel):
    name: str
    age: int

    @validator('age')
    def check_age(cls, age):
        if age < 0:
            raise ValueError('Age must be positive')
        return age
```

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:
1. –î–µ–∫–æ—Ä–∞—Ç–æ—Ä `@validator('age')` —É–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ –º–µ—Ç–æ–¥ `check_age` –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç –ø–æ–ª–µ `age`.
2. –í–∞–ª–∏–¥–∞—Ç–æ—Ä –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ–ª—è –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –µ–≥–æ (–∏–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ).
3. –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –Ω–µ–≤–∞–ª–∏–¥–Ω—ã, –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è `ValueError`.

### –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
```python
user = User(name="John", age=-5)  # –û—à–∏–±–∫–∞: Age must be positive
user = User(name="John", age=25)  # –í–∞–ª–∏–¥–Ω–æ
```


## 9. –í —á–µ–º —Ä–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É @validator, @root_validator, @before, @after, @wrap, –∏ @plain –≤–∞–ª–∏–¥–∞—Ç–æ—Ä–∞–º–∏?
–í Pydantic –µ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–∏–ø–æ–≤ –≤–∞–ª–∏–¥–∞—Ç–æ—Ä–æ–≤, –∫–∞–∂–¥—ã–π –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤. –í–æ—Ç –∏—Ö –æ—Å–Ω–æ–≤–Ω—ã–µ —Ä–∞–∑–ª–∏—á–∏—è:

---

### 1. **`@validator`**
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –í–∞–ª–∏–¥–∞—Ü–∏—è –æ–¥–Ω–æ–≥–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—è.
- **–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å**: –ö–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –æ–¥–Ω–æ–≥–æ –ø–æ–ª—è.
- **–ü—Ä–∏–º–µ—Ä**:
  ```python
  from pydantic import BaseModel, validator

  class User(BaseModel):
      name: str

      @validator('name')
      def name_must_contain_space(cls, name):
          if ' ' not in name:
              raise ValueError('Name must contain a space')
          return name
  ```

---

### 2. **`@root_validator`**
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ–π –º–æ–¥–µ–ª–∏ –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–æ–ª–µ–π –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.
- **–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å**: –ö–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–ª–µ–π –≤–º–µ—Å—Ç–µ.
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:
  - `pre=True`: –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏.
  - `pre=False` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é): –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ—Å–ª–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏.
- **–ü—Ä–∏–º–µ—Ä**:
  ```python
  from pydantic import BaseModel, root_validator

  class User(BaseModel):
      name: str
      age: int

      @root_validator
      def check_name_and_age(cls, values):
          if values['age'] < 18 and 'admin' not in values['name']:
              raise ValueError('Admins must be at least 18 years old')
          return values
  ```

---

### 3. **`@validator` —Å `pre=True`**
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–ª—è **–¥–æ** —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏.
- **–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å**: –ö–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –∏–ª–∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ–ª—è –¥–æ —Ç–æ–≥–æ, –∫–∞–∫ Pydantic –ø—Ä–∏–º–µ–Ω–∏—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞.
- **–ü—Ä–∏–º–µ—Ä**:
  ```python
  from pydantic import BaseModel, validator

  class User(BaseModel):
      age: int

      @validator('age', pre=True)
      def convert_age_to_int(cls, age):
          if isinstance(age, str):
              return int(age)
          return age
  ```

---

### 4. **`@validator` —Å `always=True`**
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–ª—è **–≤—Å–µ–≥–¥–∞**, –¥–∞–∂–µ –µ—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω–æ.
- **–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å**: –ö–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é, –¥–∞–∂–µ –µ—Å–ª–∏ –ø–æ–ª–µ –∏–º–µ–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.
- **–ü—Ä–∏–º–µ—Ä**:
  ```python
  from pydantic import BaseModel, validator

  class User(BaseModel):
      name: str = "Anonymous"

      @validator('name', always=True)
      def check_name(cls, name):
          if name == "Anonymous":
              raise ValueError('Name cannot be "Anonymous"')
          return name
  ```

---

### 5. **`@before_validator`**
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–ª—è **–¥–æ** —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (–∞–Ω–∞–ª–æ–≥ `pre=True`).
- **–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å**: –¢–æ –∂–µ, —á—Ç–æ –∏ `@validator(pre=True)`.
- **–ü—Ä–∏–º–µ—Ä**:
  ```python
  from pydantic import BaseModel, before_validator

  class User(BaseModel):
      age: int

      @before_validator('age')
      def convert_age_to_int(cls, age):
          if isinstance(age, str):
              return int(age)
          return age
  ```

---

### 6. **`@after_validator`**
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–ª—è **–ø–æ—Å–ª–µ** —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏.
- **–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å**: –ö–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ—Å–ª–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏.
- **–ü—Ä–∏–º–µ—Ä**:
  ```python
  from pydantic import BaseModel, after_validator

  class User(BaseModel):
      age: int

      @after_validator('age')
      def check_age_range(cls, age):
          if age < 0:
              raise ValueError('Age must be positive')
          return age
  ```

---

### 7. **`@wrap_validator`**
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ –≤–∞–ª–∏–¥–∞—Ç–æ—Ä–∞ —Å –ø–æ–ª–Ω—ã–º –∫–æ–Ω—Ç—Ä–æ–ª–µ–º –Ω–∞–¥ –ø—Ä–æ—Ü–µ—Å—Å–æ–º.
- **–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å**: –ö–æ–≥–¥–∞ –Ω—É–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–ª–æ–∂–Ω—É—é –ª–æ–≥–∏–∫—É –≤–∞–ª–∏–¥–∞—Ü–∏–∏.
- **–ü—Ä–∏–º–µ—Ä**:
  ```python
  from pydantic import BaseModel, wrap_validator

  class User(BaseModel):
      age: int

      @wrap_validator('age')
      def custom_age_validator(cls, value, handler):
          if value < 0:
              raise ValueError('Age must be positive')
          return handler(value)
  ```

---

### 8. **`@plain_validator`**
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –í–∞–ª–∏–¥–∞—Ü–∏—è –±–µ–∑ –ø—Ä–∏–≤—è–∑–∫–∏ –∫ –º–æ–¥–µ–ª–∏ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ä–µ–¥–∫–æ).
- **–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å**: –ö–æ–≥–¥–∞ –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –≤–∞–ª–∏–¥–∞—Ç–æ—Ä, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –º–æ–¥–µ–ª–∏.
- **–ü—Ä–∏–º–µ—Ä**:
  ```python
  from pydantic import plain_validator

  @plain_validator
  def validate_age(age):
      if age < 0:
          raise ValueError('Age must be positive')
      return age
  ```

---

### –ò—Ç–æ–≥–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞:

| **–í–∞–ª–∏–¥–∞—Ç–æ—Ä**         | **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**                                                                 | **–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å**                                                                 |
|------------------------|-------------------------------------------------------------------------------|---------------------------------------------------------------------------------------|
| `@validator`           | –í–∞–ª–∏–¥–∞—Ü–∏—è –æ–¥–Ω–æ–≥–æ –ø–æ–ª—è.                                                        | –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –æ–¥–Ω–æ–≥–æ –ø–æ–ª—è.                                          |
| `@root_validator`      | –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ–π –º–æ–¥–µ–ª–∏ –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–æ–ª–µ–π.                                   | –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–æ–ª–µ–π –≤–º–µ—Å—Ç–µ.                                       |
| `@validator(pre=True)` | –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–ª—è –¥–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏.                                      | –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∏–ª–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–Ω–∞—á–µ–Ω–∏—è –¥–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏.                             |
| `@validator(always=True)` | –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–ª—è –≤—Å–µ–≥–¥–∞, –¥–∞–∂–µ –µ—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω–æ.                    | –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª—è, –¥–∞–∂–µ –µ—Å–ª–∏ –æ–Ω–æ –∏–º–µ–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.                             |
| `@before_validator`    | –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–ª—è –¥–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (–∞–Ω–∞–ª–æ–≥ `pre=True`).                  | –¢–æ –∂–µ, —á—Ç–æ –∏ `@validator(pre=True)`.                                                  |
| `@after_validator`     | –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–ª—è –ø–æ—Å–ª–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏.                                   | –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ—Å–ª–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏.                                  |
| `@wrap_validator`      | –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ –≤–∞–ª–∏–¥–∞—Ç–æ—Ä–∞ —Å –ø–æ–ª–Ω—ã–º –∫–æ–Ω—Ç—Ä–æ–ª–µ–º.                            | –°–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏.                                                             |
| `@plain_validator`     | –í–∞–ª–∏–¥–∞—Ü–∏—è –±–µ–∑ –ø—Ä–∏–≤—è–∑–∫–∏ –∫ –º–æ–¥–µ–ª–∏.                                              | –†–µ–¥–∫–∏–µ —Å–ª—É—á–∞–∏, –∫–æ–≥–¥–∞ –≤–∞–ª–∏–¥–∞—Ç–æ—Ä –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –º–æ–¥–µ–ª–∏.                                  |

–¢–µ–ø–µ—Ä—å —Ç—ã –∑–Ω–∞–µ—à—å, –∫–∞–∫ –∏ –∫–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∂–¥—ã–π —Ç–∏–ø –≤–∞–ª–∏–¥–∞—Ç–æ—Ä–∞! üòä

## 10. –ö–æ–≥–¥–∞ —Å–ª–µ–¥—É–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å @before –≤–∞–ª–∏–¥–∞—Ç–æ—Ä –∏ –∫–∞–∫–∏–µ –∑–∞–¥–∞—á–∏ –æ–Ω —Ä–µ—à–∞–µ—Ç?
`@before` –≤–∞–ª–∏–¥–∞—Ç–æ—Ä (–∏–ª–∏ `@validator` —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º `pre=True`) –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ **–¥–æ** —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–∏–ø–æ–≤ –∏ –ø—Ä–∞–≤–∏–ª Pydantic. –û–Ω —Ä–µ—à–∞–µ—Ç –∑–∞–¥–∞—á–∏, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –¥–∞–Ω–Ω—ã—Ö, –∏ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–ª–µ–∑–µ–Ω –≤ —Å–ª–µ–¥—É—é—â–∏—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö:

---

### **–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `@before` –≤–∞–ª–∏–¥–∞—Ç–æ—Ä?**
1. **–ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö**:
   - –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å —Å—Ç—Ä–æ–∫—É –≤ —á–∏—Å–ª–æ).

2. **–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö**:
   - –ï—Å–ª–∏ –Ω—É–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å –ª–∏—à–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã, –ø—Ä–∏–≤–µ—Å—Ç–∏ —Å—Ç—Ä–æ–∫—É –∫ –Ω–∏–∂–Ω–µ–º—É —Ä–µ–≥–∏—Å—Ç—Ä—É –∏–ª–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –¥—Ä—É–≥–∏–µ –º–∞–Ω–∏–ø—É–ª—è—Ü–∏–∏.

3. **–†–∞–Ω–Ω—è—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö**:
   - –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–æ —Ç–æ–≥–æ, –∫–∞–∫ Pydantic –ø—Ä–∏–º–µ–Ω–∏—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Å—Ç—Ä–æ–∫–∞ –Ω–µ –ø—É—Å—Ç–∞—è).

4. **–õ–æ–≥–∏–∫–∞, –∑–∞–≤–∏—Å—è—â–∞—è –æ—Ç —Å—ã—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö**:
   - –ï—Å–ª–∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∏—Å—Ö–æ–¥–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞ –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å—Å—è –ø–æ—Å–ª–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏.

---

### **–ü—Ä–∏–º–µ—Ä—ã –∑–∞–¥–∞—á, –∫–æ—Ç–æ—Ä—ã–µ —Ä–µ—à–∞–µ—Ç `@before` –≤–∞–ª–∏–¥–∞—Ç–æ—Ä**

#### 1. **–ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ –≤ —á–∏—Å–ª–æ**
```python
from pydantic import BaseModel, validator

class User(BaseModel):
    age: int

    @validator('age', pre=True)
    def convert_age_to_int(cls, age):
        if isinstance(age, str):
            return int(age)  # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º —Å—Ç—Ä–æ–∫—É –≤ —á–∏—Å–ª–æ
        return age
```

#### 2. **–û—á–∏—Å—Ç–∫–∞ —Å—Ç—Ä–æ–∫–∏**
```python
from pydantic import BaseModel, validator

class User(BaseModel):
    name: str

    @validator('name', pre=True)
    def clean_name(cls, name):
        return name.strip().title()  # –£–¥–∞–ª—è–µ–º –ø—Ä–æ–±–µ–ª—ã –∏ –ø—Ä–∏–≤–æ–¥–∏–º –∫ –∑–∞–≥–ª–∞–≤–Ω—ã–º –±—É–∫–≤–∞–º
```

#### 3. **–†–∞–Ω–Ω—è—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö**
```python
from pydantic import BaseModel, validator

class User(BaseModel):
    email: str

    @validator('email', pre=True)
    def check_email_not_empty(cls, email):
        if not email:
            raise ValueError('Email cannot be empty')
        return email
```

#### 4. **–õ–æ–≥–∏–∫–∞, –∑–∞–≤–∏—Å—è—â–∞—è –æ—Ç —Å—ã—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö**
```python
from pydantic import BaseModel, validator

class User(BaseModel):
    age: int

    @validator('age', pre=True)
    def check_age_format(cls, age):
        if isinstance(age, str) and not age.isdigit():
            raise ValueError('Age must be a number')
        return age
```

---

### **–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç `@before` –≤–∞–ª–∏–¥–∞—Ç–æ—Ä?**
1. **–ü–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**:
   - `@before` –≤–∞–ª–∏–¥–∞—Ç–æ—Ä –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è **–¥–æ** —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏ Pydantic.
   - –ü–æ—Å–ª–µ –Ω–µ–≥–æ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤).

2. **–í–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ**:
   - –í–∞–ª–∏–¥–∞—Ç–æ—Ä –¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –±—É–¥–µ—Ç –ø–µ—Ä–µ–¥–∞–Ω–æ –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é.

3. **–û—à–∏–±–∫–∏**:
   - –ï—Å–ª–∏ –≤–∞–ª–∏–¥–∞—Ç–æ—Ä –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏–µ, —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è.

---

### **–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è**
```python
class User(BaseModel):
    age: int

    @validator('age', pre=True)
    def convert_age_to_int(cls, age):
        if isinstance(age, str):
            return int(age)
        return age

user = User(age="25")  # –í–∞–ª–∏–¥–Ω–æ: —Å—Ç—Ä–æ–∫–∞ "25" –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∞ –≤ —á–∏—Å–ª–æ 25
print(user.age)  # 25
```

---

### **–ò—Ç–æ–≥**
–ò—Å–ø–æ–ª—å–∑—É–π `@before` –≤–∞–ª–∏–¥–∞—Ç–æ—Ä (`@validator` —Å `pre=True`), –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ:
- –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π.
- –û—á–∏—Å—Ç–∏—Ç—å –∏–ª–∏ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–∞–Ω–Ω—ã–µ.
- –í—ã–ø–æ–ª–Ω–∏—Ç—å –ª–æ–≥–∏–∫—É, –∑–∞–≤–∏—Å—è—â—É—é –æ—Ç —Å—ã—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö.


## 11. –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å @after –≤–∞–ª–∏–¥–∞—Ç–æ—Ä –∏ –≤ –∫–∞–∫–∏—Ö —Å–ª—É—á–∞—è—Ö –æ–Ω –ø—Ä–∏–º–µ–Ω–∏–º?
`@after`¬†–≤–∞–ª–∏–¥–∞—Ç–æ—Ä (–∏–ª–∏¬†`@validator`¬†–±–µ–∑¬†`pre=True`, –ª–∏–±–æ¬†`@after_validator`) –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏¬†**–ø–æ—Å–ª–µ**¬†—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–∏–ø–æ–≤ –∏ –ø—Ä–∞–≤–∏–ª Pydantic. –û–Ω —Ä–µ—à–∞–µ—Ç –∑–∞–¥–∞—á–∏, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–æ–π –∏–ª–∏ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –ø—Ä–æ—à–ª–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é.

---

### **–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å¬†`@after`¬†–≤–∞–ª–∏–¥–∞—Ç–æ—Ä?**

1. **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö**:
    
    - –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ Pydantic –ø—Ä–∏–º–µ–Ω–∏–ª —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —á–∏—Å–ª–æ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –¥–æ–ø—É—Å—Ç–∏–º–æ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ).
        
2. **–õ–æ–≥–∏–∫–∞, –∑–∞–≤–∏—Å—è—â–∞—è –æ—Ç –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö**:
    
    - –ï—Å–ª–∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –ø—Ä–æ—à–ª–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –¥–≤—É—Ö –ø–æ–ª–µ–π).
        
3. **–ò–∑–º–µ–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ—Å–ª–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏**:
    
    - –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ–ª—è –ø–æ—Å–ª–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏).

## 12. –ß—Ç–æ —Ç–∞–∫–æ–µ @wrap –≤–∞–ª–∏–¥–∞—Ç–æ—Ä –∏ –∫–∞–∫ –æ–Ω –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–±–µ—Ä–Ω—É—Ç—å –ø—Ä–æ—Ü–µ—Å—Å –≤–∞–ª–∏–¥–∞—Ü–∏–∏?
`@wrap` –≤–∞–ª–∏–¥–∞—Ç–æ—Ä (–∏–ª–∏ `@wrap_validator`) ‚Äî —ç—Ç–æ –º–æ—â–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –≤ Pydantic, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç **–ø–æ–ª–Ω–æ—Å—Ç—å—é –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å –≤–∞–ª–∏–¥–∞—Ü–∏–∏**. –û–Ω –æ–±–æ—Ä–∞—á–∏–≤–∞–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é –ª–æ–≥–∏–∫—É –≤–∞–ª–∏–¥–∞—Ü–∏–∏, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤—ã–ø–æ–ª–Ω–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –¥–æ –∏–ª–∏ –ø–æ—Å–ª–µ –Ω–µ—ë.

---

### **–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `@wrap` –≤–∞–ª–∏–¥–∞—Ç–æ—Ä?**
1. **–ö–∞—Å—Ç–æ–º–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏**:
   - –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Å–ª–æ–∂–Ω—É—é –ª–æ–≥–∏–∫—É, –∫–æ—Ç–æ—Ä–∞—è –Ω–µ —É–∫–ª–∞–¥—ã–≤–∞–µ—Ç—Å—è –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –≤–∞–ª–∏–¥–∞—Ç–æ—Ä—ã.

2. **–ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏**:
   - –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –∏–ª–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é Pydantic.

3. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π**:
   - –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—Ç—å –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –æ—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏.

4. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–ª–∏ –æ—Ç–ª–∞–¥–∫–∞**:
   - –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–ª–∏ –≤—ã–ø–æ–ª–Ω—è—Ç—å –æ—Ç–ª–∞–¥–∫—É –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏.

---

### **–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç `@wrap` –≤–∞–ª–∏–¥–∞—Ç–æ—Ä?**
1. **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:
   - `value`: –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ–ª—è, –∫–æ—Ç–æ—Ä–æ–µ –Ω—É–∂–Ω–æ –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å.
   - `handler`: –§—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é Pydantic.

2. **–õ–æ–≥–∏–∫–∞**:
   - –í—ã –º–æ–∂–µ—Ç–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –¥–µ–π—Å—Ç–≤–∏—è –¥–æ –≤—ã–∑–æ–≤–∞ `handler` (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∏–∑–º–µ–Ω–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ).
   - –í—ã–∑–≤–∞—Ç—å `handler`, —á—Ç–æ–±—ã –ø—Ä–∏–º–µ–Ω–∏—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é.
   - –í—ã–ø–æ–ª–Ω–∏—Ç—å –¥–µ–π—Å—Ç–≤–∏—è –ø–æ—Å–ª–µ –≤—ã–∑–æ–≤–∞ `handler` (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∏–∑–º–µ–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç).

3. **–í–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ**:
   - –í–∞–ª–∏–¥–∞—Ç–æ—Ä –¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –±—É–¥–µ—Ç –ø—Ä–∏—Å–≤–æ–µ–Ω–æ –ø–æ–ª—é.

---

### **–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `@wrap` –≤–∞–ª–∏–¥–∞—Ç–æ—Ä–∞**

#### 1. **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –¥–æ –∏ –ø–æ—Å–ª–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏**
```python
from pydantic import BaseModel, wrap_validator

class User(BaseModel):
    age: int

    @wrap_validator('age')
    def custom_age_validator(cls, value, handler):
        print(f"Before validation: {value}")  # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
        result = handler(value)  # –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
        print(f"After validation: {result}")  # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Å–ª–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
        return result
```

#### 2. **–ò–∑–º–µ–Ω–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–æ –≤–∞–ª–∏–¥–∞—Ü–∏–∏**
```python
from pydantic import BaseModel, wrap_validator

class User(BaseModel):
    age: int

    @wrap_validator('age')
    def convert_age_to_int(cls, value, handler):
        if isinstance(value, str):
            value = int(value)  # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º —Å—Ç—Ä–æ–∫—É –≤ —á–∏—Å–ª–æ
        return handler(value)  # –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
```

#### 3. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π**
```python
from pydantic import BaseModel, wrap_validator, ValidationError

class User(BaseModel):
    age: int

    @wrap_validator('age')
    def handle_validation_errors(cls, value, handler):
        try:
            return handler(value)  # –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
        except ValidationError as e:
            print(f"Validation error: {e}")  # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–∫–∏
            raise  # –ü–æ–≤—Ç–æ—Ä–Ω–æ –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ–º –∏—Å–∫–ª—é—á–µ–Ω–∏–µ
```

#### 4. **–ö–∞—Å—Ç–æ–º–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏**
```python
from pydantic import BaseModel, wrap_validator

class User(BaseModel):
    age: int

    @wrap_validator('age')
    def custom_age_validator(cls, value, handler):
        if value < 0:
            raise ValueError('Age must be positive')  # –ö–∞—Å—Ç–æ–º–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
        return handler(value)  # –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
```

---

### **–ò—Ç–æ–≥**
`@wrap` –≤–∞–ª–∏–¥–∞—Ç–æ—Ä –ø–æ–∑–≤–æ–ª—è–µ—Ç:
- –ü–æ–ª–Ω–æ—Å—Ç—å—é –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å –≤–∞–ª–∏–¥–∞—Ü–∏–∏.
- –î–æ–±–∞–≤–ª—è—Ç—å –ª–æ–≥–∏–∫—É –¥–æ –∏–ª–∏ –ø–æ—Å–ª–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏.
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏—è –∏ –≤—ã–ø–æ–ª–Ω—è—Ç—å —Å–ª–æ–∂–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏.

–ò—Å–ø–æ–ª—å–∑—É–π –µ–≥–æ, –∫–æ–≥–¥–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –≤–∞–ª–∏–¥–∞—Ç–æ—Ä–æ–≤ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è —Ä–µ—à–µ–Ω–∏—è –∑–∞–¥–∞—á–∏! üòä
## 13. –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç @plain –≤–∞–ª–∏–¥–∞—Ç–æ—Ä –∏ —á–µ–º –æ–Ω –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç –¥—Ä—É–≥–∏—Ö —Ç–∏–ø–æ–≤ –≤–∞–ª–∏–¥–∞—Ç–æ—Ä–æ–≤?
### **–ß–µ–º¬†`@plain`¬†–≤–∞–ª–∏–¥–∞—Ç–æ—Ä –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç –¥—Ä—É–≥–∏—Ö –≤–∞–ª–∏–¥–∞—Ç–æ—Ä–æ–≤?**

|**–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞**|**`@plain`¬†–≤–∞–ª–∏–¥–∞—Ç–æ—Ä**|**–î—Ä—É–≥–∏–µ –≤–∞–ª–∏–¥–∞—Ç–æ—Ä—ã (`@validator`,¬†`@root_validator`)**|
|---|---|---|
|**–ü—Ä–∏–≤—è–∑–∫–∞ –∫ –º–æ–¥–µ–ª–∏**|–ù–µ—Ç|–î–∞ (–ø—Ä–∏–≤—è–∑–∞–Ω –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –º–æ–¥–µ–ª–∏ –∏–ª–∏ –ø–æ–ª—é)|
|**–î–æ—Å—Ç—É–ø –∫ –¥—Ä—É–≥–∏–º –ø–æ–ª—è–º**|–ù–µ—Ç|–î–∞ (—á–µ—Ä–µ–∑¬†`values`¬†–≤¬†`@root_validator`)|
|**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**|–ù–µ–∑–∞–≤–∏—Å–∏–º–∞—è —Ñ—É–Ω–∫—Ü–∏—è, –º–æ–∂–µ—Ç –±—ã—Ç—å –≤—ã–∑–≤–∞–Ω–∞ –≤—Ä—É—á–Ω—É—é|–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –º–æ–¥–µ–ª–∏|
|**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è**|–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –≤–Ω–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –º–æ–¥–µ–ª–∏|–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –º–æ–¥–µ–ª–∏|

`@plain`¬†–≤–∞–ª–∏–¥–∞—Ç–æ—Ä:

- –≠—Ç–æ –Ω–µ–∑–∞–≤–∏—Å–∏–º–∞—è —Ñ—É–Ω–∫—Ü–∏—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏, –Ω–µ –ø—Ä–∏–≤—è–∑–∞–Ω–Ω–∞—è –∫ –º–æ–¥–µ–ª–∏.
    
- –ü–æ–ª–µ–∑–µ–Ω –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–π –ª–æ–≥–∏–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏.
    
- –û—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç –¥—Ä—É–≥–∏—Ö –≤–∞–ª–∏–¥–∞—Ç–æ—Ä–æ–≤ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ–º –ø—Ä–∏–≤—è–∑–∫–∏ –∫ –º–æ–¥–µ–ª–∏ –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É.
## 14. –ö–∞–∫ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏ –≤ Pydantic?
–í–ª–æ–∂–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏ –≤ Pydantic –ø–æ–∑–≤–æ–ª—è—é—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–ª–æ–∂–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö, –≥–¥–µ –æ–¥–Ω–∞ –º–æ–¥–µ–ª—å –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –¥—Ä—É–≥—É—é. –≠—Ç–æ –ø–æ–ª–µ–∑–Ω–æ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏, —Ç–∞–∫–∏–º–∏ –∫–∞–∫ JSON, API-–∑–∞–ø—Ä–æ—Å—ã –∏–ª–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.

---

### **–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏?**

1. **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤–ª–æ–∂–µ–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏**:
   –°–æ–∑–¥–∞–π –æ—Ç–¥–µ–ª—å–Ω—É—é –º–æ–¥–µ–ª—å, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∫–∞–∫ –ø–æ–ª–µ –≤ –¥—Ä—É–≥–æ–π –º–æ–¥–µ–ª–∏.

2. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤–ª–æ–∂–µ–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏**:
   –£–∫–∞–∂–∏ –≤–ª–æ–∂–µ–Ω–Ω—É—é –º–æ–¥–µ–ª—å –∫–∞–∫ —Ç–∏–ø –ø–æ–ª—è –≤ –æ—Å–Ω–æ–≤–Ω–æ–π –º–æ–¥–µ–ª–∏.

3. **–í–∞–ª–∏–¥–∞—Ü–∏—è –∏ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è**:
   Pydantic –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç –∏ —Å–µ—Ä–∏–∞–ª–∏–∑—É–µ—Ç –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏.

---

### **–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π**

#### 1. **–ü—Ä–æ—Å—Ç–∞—è –≤–ª–æ–∂–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å**
```python
from pydantic import BaseModel

class Address(BaseModel):
    city: str
    street: str

class User(BaseModel):
    name: str
    age: int
    address: Address  # –í–ª–æ–∂–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å

# –°–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞
user = User(
    name="John",
    age=30,
    address={"city": "New York", "street": "5th Ave"}  # –í–ª–æ–∂–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
)

print(user)
# name='John' age=30 address=Address(city='New York', street='5th Ave')

print(user.address.city)  # –î–æ—Å—Ç—É–ø –∫ –ø–æ–ª—é –≤–ª–æ–∂–µ–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏
# New York
```

#### 2. **–í–ª–æ–∂–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏ –≤ —Å–ø–∏—Å–∫–∞—Ö**
```python
from typing import List
from pydantic import BaseModel

class Item(BaseModel):
    name: str
    price: float

class Order(BaseModel):
    id: int
    items: List[Item]  # –°–ø–∏—Å–æ–∫ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π

# –°–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞
order = Order(
    id=1,
    items=[
        {"name": "Laptop", "price": 1200.0},
        {"name": "Mouse", "price": 25.0}
    ]
)

print(order)
# id=1 items=[Item(name='Laptop', price=1200.0), Item(name='Mouse', price=25.0)]
```

#### 3. **–ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—ã–µ –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏**
```python
from pydantic import BaseModel

class Profile(BaseModel):
    bio: str
    website: str

class Address(BaseModel):
    city: str
    street: str

class User(BaseModel):
    name: str
    age: int
    address: Address
    profile: Profile  # –ï—â–µ –æ–¥–Ω–∞ –≤–ª–æ–∂–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å

# –°–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞
user = User(
    name="Alice",
    age=25,
    address={"city": "Los Angeles", "street": "Sunset Blvd"},
    profile={"bio": "Software Engineer", "website": "https://example.com"}
)

print(user)
# name='Alice' age=25 address=Address(city='Los Angeles', street='Sunset Blvd') profile=Profile(bio='Software Engineer', website='https://example.com')
```

---

### **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π**
1. **–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö**:
   - –ü–æ–∑–≤–æ–ª—è—é—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–ª–æ–∂–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.
2. **–í–∞–ª–∏–¥–∞—Ü–∏—è**:
   - –í–ª–æ–∂–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–∞–ª–∏–¥–∏—Ä—É—é—Ç—Å—è.
3. **–°–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è**:
   - –í–ª–æ–∂–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–µ—Ä–∏–∞–ª–∏–∑—É—é—Ç—Å—è –≤ JSON –∏–ª–∏ —Å–ª–æ–≤–∞—Ä—å.
4. **–ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**:
   - –ú–æ–¥–µ–ª–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ —Ä–∞–∑–Ω—ã—Ö –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞—Ö.

---

### **–ü—Ä–∏–º–µ—Ä —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π**
```python
# –°–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤ —Å–ª–æ–≤–∞—Ä—å
user_dict = user.dict()
print(user_dict)
# {
#   'name': 'Alice',
#   'age': 25,
#   'address': {'city': 'Los Angeles', 'street': 'Sunset Blvd'},
#   'profile': {'bio': 'Software Engineer', 'website': 'https://example.com'}
# }

# –°–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤ JSON
user_json = user.json()
print(user_json)
# {"name": "Alice", "age": 25, "address": {"city": "Los Angeles", "street": "Sunset Blvd"}, "profile": {"bio": "Software Engineer", "website": "https://example.com"}}
```

---

### **–ò—Ç–æ–≥**
–í–ª–æ–∂–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏ –≤ Pydantic:
- –ü–æ–∑–≤–æ–ª—è—é—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–ª–æ–∂–Ω—ã–µ –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö.
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–∞–ª–∏–¥–∏—Ä—É—é—Ç—Å—è –∏ —Å–µ—Ä–∏–∞–ª–∏–∑—É—é—Ç—Å—è.
- –£–ø—Ä–æ—â–∞—é—Ç –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é –∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞.

–ò—Å–ø–æ–ª—å–∑—É–π –∏—Ö –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å API, –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è–º–∏ –∏–ª–∏ –ª—é–±—ã–º–∏ —Å–ª–æ–∂–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏! üòä
## 15. –ö–∞–∫ –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏–ª–∏ –∏—Å–∫–ª—é—á–∞—Ç—å –ø–æ–ª—è –∏–∑ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –≤ Pydantic –º–æ–¥–µ–ª–∏?
- **`exclude`**: –ò—Å–∫–ª—é—á–∞–µ—Ç —É–∫–∞–∑–∞–Ω–Ω—ã–µ –ø–æ–ª—è.
    
- **`exclude_unset`**: –ò—Å–∫–ª—é—á–∞–µ—Ç –Ω–µ –∑–∞–¥–∞–Ω–Ω—ã–µ –ø–æ–ª—è.
    
- **`exclude_defaults`**: –ò—Å–∫–ª—é—á–∞–µ—Ç –ø–æ–ª—è —Å–æ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.
    
- **`exclude_none`**: –ò—Å–∫–ª—é—á–∞–µ—Ç –ø–æ–ª—è —Å–æ –∑–Ω–∞—á–µ–Ω–∏–µ–º¬†`None`.
    
- **`Field(exclude=True)`**: –ü–æ—Å—Ç–æ—è–Ω–Ω–æ –∏—Å–∫–ª—é—á–∞–µ—Ç –ø–æ–ª–µ –∏–∑ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏.
- 
```python
from pydantic import BaseModel

class User(BaseModel):
    name: str
    age: int
    password: str

user = User(name="John", age=30, password="secret")

# –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ
exclude_fields = {"password"}
user_dict = user.dict(exclude=exclude_fields)
print(user_dict)  # {'name': 'John', 'age': 30}
```
## 16. –ö–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç –∞–ª–∏–∞—Å—ã –ø–æ–ª–µ–π (Field(..., alias='other_name')) –≤ Pydantic?
- **–ê–ª–∏–∞—Å—ã**¬†–ø–æ–∑–≤–æ–ª—è—é—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ –∏–º–µ–Ω–∞ –¥–ª—è –ø–æ–ª–µ–π –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö.
    
- **`by_alias=True`**¬†–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å –∞–ª–∏–∞—Å–∞–º–∏.
    
- **`allow_population_by_field_name`**¬†–ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∫–∞–∫ –ø–æ –∞–ª–∏–∞—Å—É, —Ç–∞–∫ –∏ –ø–æ –∏–º–µ–Ω–∏ –ø–æ–ª—è.
    
```python
from pydantic import BaseModel, Field

class User(BaseModel):
    name: str = Field(..., alias="full_name")
    age: int

    class Config:
        allow_population_by_field_name = True

# –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ –∏–º–µ–Ω–∏ –ø–æ–ª—è
data = {"name": "John", "age": 30}
user = User(**data)

print(user.name)  # John
print(user.age)   # 30
```
## 18. –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –º–µ—Ç–æ–¥ dict() –≤ Pydantic –∏ –∫–∞–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–Ω –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç?
–ú–µ—Ç–æ–¥ `dict()` –≤ Pydantic –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –º–æ–¥–µ–ª–∏ –≤ —Å–ª–æ–≤–∞—Ä—å Python. –û–Ω –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–∑–≤–æ–ª—è—é—Ç –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å, –∫–∞–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –≤–∫–ª—é—á–∞—Ç—å –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏ –∫–∞–∫ –∏—Ö —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å.

---

### **–û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –º–µ—Ç–æ–¥–∞ `dict()`**

| **–ü–∞—Ä–∞–º–µ—Ç—Ä**          | **–û–ø–∏—Å–∞–Ω–∏–µ**                                                                 |
|------------------------|-----------------------------------------------------------------------------|
| `include`             | –í–∫–ª—é—á–∞–µ—Ç —Ç–æ–ª—å–∫–æ —É–∫–∞–∑–∞–Ω–Ω—ã–µ –ø–æ–ª—è.                                             |
| `exclude`             | –ò—Å–∫–ª—é—á–∞–µ—Ç —É–∫–∞–∑–∞–Ω–Ω—ã–µ –ø–æ–ª—è.                                                   |
| `by_alias`            | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –∞–ª–∏–∞—Å—ã –ø–æ–ª–µ–π –≤–º–µ—Å—Ç–æ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã—Ö –∏–º–µ–Ω.                           |
| `exclude_unset`       | –ò—Å–∫–ª—é—á–∞–µ—Ç –ø–æ–ª—è, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –±—ã–ª–∏ –∑–∞–¥–∞–Ω—ã –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –æ–±—ä–µ–∫—Ç–∞.                |
| `exclude_defaults`    | –ò—Å–∫–ª—é—á–∞–µ—Ç –ø–æ–ª—è, –∫–æ—Ç–æ—Ä—ã–µ –∏–º–µ—é—Ç –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.                        |
| `exclude_none`        | –ò—Å–∫–ª—é—á–∞–µ—Ç –ø–æ–ª—è, –∫–æ—Ç–æ—Ä—ã–µ –∏–º–µ—é—Ç –∑–Ω–∞—á–µ–Ω–∏–µ `None`.                              |
| `exclude_defaults`    | –ò—Å–∫–ª—é—á–∞–µ—Ç –ø–æ–ª—è, –∫–æ—Ç–æ—Ä—ã–µ –∏–º–µ—é—Ç –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.                        |

---

### **–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è**

#### 1. **–ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**
```python
from pydantic import BaseModel

class User(BaseModel):
    name: str
    age: int
    email: str = None

user = User(name="John", age=30)

# –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏ –≤ —Å–ª–æ–≤–∞—Ä—å
user_dict = user.dict()
print(user_dict)  # {'name': 'John', 'age': 30, 'email': None}
```

#### 2. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `include`**
```python
# –í–∫–ª—é—á–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–æ–ª–µ `name`
user_dict = user.dict(include={"name"})
print(user_dict)  # {'name': 'John'}
```


### **–ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤**
–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –º–æ–∂–Ω–æ –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞—Ç—å –¥–ª—è –±–æ–ª–µ–µ –≥–∏–±–∫–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤—ã–≤–æ–¥–æ–º.

#### –ü—Ä–∏–º–µ—Ä:
```python
# –ò—Å–∫–ª—é—á–∞–µ–º –ø–æ–ª–µ `age` –∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º –∞–ª–∏–∞—Å—ã
user_dict = user.dict(exclude={"age"}, by_alias=True)
print(user_dict)  # {'full_name': 'John'}
```

---
–ú–µ—Ç–æ–¥ `dict()` –≤ Pydantic:
- –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –º–æ–¥–µ–ª—å –≤ —Å–ª–æ–≤–∞—Ä—å.
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è –≤–∫–ª—é—á–∞–µ–º—ã—Ö –∏ –∏—Å–∫–ª—é—á–∞–µ–º—ã—Ö –ø–æ–ª–µ–π.
- –ü–æ–∑–≤–æ–ª—è–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞–ª–∏–∞—Å—ã –∏ –∏—Å–∫–ª—é—á–∞—Ç—å –Ω–µ –∑–∞–¥–∞–Ω–Ω—ã–µ –ø–æ–ª—è –∏–ª–∏ –ø–æ–ª—è —Å–æ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.
## Field
`Field` ‚Äî —ç—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è –≤ Pydantic, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∑–≤–æ–ª—è–µ—Ç **–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –ø–æ–ª—è –º–æ–¥–µ–ª–∏** —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏, —Ç–∞–∫–∏–º–∏ –∫–∞–∫ –æ–ø–∏—Å–∞–Ω–∏–µ, –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –∞–ª–∏–∞—Å—ã, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ –º–Ω–æ–≥–æ–µ –¥—Ä—É–≥–æ–µ. –û–Ω–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –±–æ–ª–µ–µ —Ç–æ–Ω–∫–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—è –Ω–∞–¥ –ø–æ–≤–µ–¥–µ–Ω–∏–µ–º –ø–æ–ª–µ–π –º–æ–¥–µ–ª–∏.

---

### **–û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã `Field`**

| **–ü–∞—Ä–∞–º–µ—Ç—Ä**          | **–û–ø–∏—Å–∞–Ω–∏–µ**                                                                 |
|------------------------|-----------------------------------------------------------------------------|
| `default`             | –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –ø–æ–ª—è.                                             |
| `alias`               | –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ –∏–º—è –¥–ª—è –ø–æ–ª—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å JSON).                  |
| `description`         | –û–ø–∏—Å–∞–Ω–∏–µ –ø–æ–ª—è (–ø–æ–ª–µ–∑–Ω–æ –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏).                                   |
| `gt`, `ge`, `lt`, `le`| –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –∑–Ω–∞—á–µ–Ω–∏–µ (–±–æ–ª—å—à–µ, –±–æ–ª—å—à–µ –∏–ª–∏ —Ä–∞–≤–Ω–æ, –º–µ–Ω—å—à–µ, –º–µ–Ω—å—à–µ –∏–ª–∏ —Ä–∞–≤–Ω–æ).|
| `min_length`, `max_length` | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –¥–ª–∏–Ω—É —Å—Ç—Ä–æ–∫–∏ –∏–ª–∏ –∫–æ–ª–ª–µ–∫—Ü–∏–∏.                             |
| `regex`               | –†–µ–≥—É–ª—è—Ä–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å—Ç—Ä–æ–∫–∏.                                  |
| `exclude`             | –ò—Å–∫–ª—é—á–∞–µ—Ç –ø–æ–ª–µ –∏–∑ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏.                                             |
| `example`             | –ü—Ä–∏–º–µ—Ä –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏.                                           |

---

### **–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `Field`**

#### 1. **–ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é**
```python
from pydantic import BaseModel, Field

class User(BaseModel):
    name: str = Field(default="Anonymous")
    age: int = Field(default=18)

user = User()
print(user)  # name='Anonymous' age=18
```

#### 2. **–ê–ª–∏–∞—Å—ã**
```python
from pydantic import BaseModel, Field

class User(BaseModel):
    name: str = Field(..., alias="full_name")

user = User(full_name="John")
print(user.name)  # John
```

#### 3. **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –∑–Ω–∞—á–µ–Ω–∏–µ**
```python
from pydantic import BaseModel, Field, ValidationError

class User(BaseModel):
    age: int = Field(..., gt=0, lt=100)  # –í–æ–∑—Ä–∞—Å—Ç –æ—Ç 1 –¥–æ 99

try:
    user = User(age=150)  # –û—à–∏–±–∫–∞: –≤–æ–∑—Ä–∞—Å—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–µ–Ω—å—à–µ 100
except ValidationError as e:
    print(e)
```

#### 4. **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –¥–ª–∏–Ω—É —Å—Ç—Ä–æ–∫–∏**
```python
from pydantic import BaseModel, Field

class User(BaseModel):
    name: str = Field(..., min_length=3, max_length=50)

user = User(name="John")
print(user)  # name='John'
```

#### 5. **–†–µ–≥—É–ª—è—Ä–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ**
```python
from pydantic import BaseModel, Field, ValidationError

class User(BaseModel):
    email: str = Field(..., regex=r"^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\.[a-zA-Z0-9-.]+$")

try:
    user = User(email="invalid-email")  # –û—à–∏–±–∫–∞: –Ω–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç email
except ValidationError as e:
    print(e)
```

#### 6. **–û–ø–∏—Å–∞–Ω–∏–µ –∏ –ø—Ä–∏–º–µ—Ä**
```python
from pydantic import BaseModel, Field

class User(BaseModel):
    name: str = Field(..., description="Full name of the user", example="John Doe")
    age: int = Field(..., description="Age of the user", example=30)

print(User.schema())
# {
#   "title": "User",
#   "type": "object",
#   "properties": {
#     "name": {"description": "Full name of the user", "example": "John Doe", "title": "Name", "type": "string"},
#     "age": {"description": "Age of the user", "example": 30, "title": "Age", "type": "integer"}
#   },
#   "required": ["name", "age"]
# }
```

#### 7. **–ò—Å–∫–ª—é—á–µ–Ω–∏–µ –ø–æ–ª—è –∏–∑ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏**
```python
from pydantic import BaseModel, Field

class User(BaseModel):
    name: str
    password: str = Field(..., exclude=True)  # –ü–æ–ª–µ –∏—Å–∫–ª—é—á–µ–Ω–æ –∏–∑ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏

user = User(name="John", password="secret")
print(user.dict())  # {'name': 'John'}
```

---

### **–ò—Ç–æ–≥**
`Field` –≤ Pydantic:
- –ü–æ–∑–≤–æ–ª—è–µ—Ç –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –ø–æ–ª—è –º–æ–¥–µ–ª–∏ —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏.
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è, –∞–ª–∏–∞—Å—ã, –æ–ø–∏—Å–∞–Ω–∏—è, –ø—Ä–∏–º–µ—Ä—ã –∏ –º–Ω–æ–≥–æ–µ –¥—Ä—É–≥–æ–µ.
- –£–ø—Ä–æ—â–∞–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏—é –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö.

–ò—Å–ø–æ–ª—å–∑—É–π `Field` –¥–ª—è –±–æ–ª–µ–µ –≥–∏–±–∫–æ–≥–æ –∏ –º–æ—â–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—è–º–∏ –º–æ–¥–µ–ª–∏! üòä
## –ö–æ–≥–¥–∞ –Ω—É–∂–µ–Ω Field –∫–æ–≥–¥–∞ validtor

`Field` –∏ `validator` –≤ Pydantic —Ä–µ—à–∞—é—Ç —Ä–∞–∑–Ω—ã–µ –∑–∞–¥–∞—á–∏, –∏ –∏—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–æ–≥–æ, —á—Ç–æ –∏–º–µ–Ω–Ω–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å —Å –¥–∞–Ω–Ω—ã–º–∏. –í–æ—Ç –æ—Å–Ω–æ–≤–Ω—ã–µ —Ä–∞–∑–ª–∏—á–∏—è –∏ –ø—Ä–∏–º–µ—Ä—ã, –∫–æ–≥–¥–∞ —á—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:

---

### **–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `Field`?**

`Field` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è **–Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª–µ–π –º–æ–¥–µ–ª–∏** –∏ –∑–∞–¥–∞–Ω–∏—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤, —Ç–∞–∫–∏—Ö –∫–∞–∫:
- –ó–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.
- –ê–ª–∏–∞—Å—ã (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –∏–º–µ–Ω–∞ –ø–æ–ª–µ–π).
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –∑–Ω–∞—á–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ/–º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, –¥–ª–∏–Ω–∞ —Å—Ç—Ä–æ–∫–∏).
- –û–ø–∏—Å–∞–Ω–∏—è –∏ –ø—Ä–∏–º–µ—Ä—ã –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏.
- –ò—Å–∫–ª—é—á–µ–Ω–∏–µ –ø–æ–ª–µ–π –∏–∑ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏.

#### –ü—Ä–∏–º–µ—Ä—ã:
1. **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –∑–Ω–∞—á–µ–Ω–∏–µ**:
   ```python
   from pydantic import BaseModel, Field

   class User(BaseModel):
       age: int = Field(..., gt=0, lt=100)  # –í–æ–∑—Ä–∞—Å—Ç –æ—Ç 1 –¥–æ 99
   ```

2. **–ê–ª–∏–∞—Å—ã**:
   ```python
   class User(BaseModel):
       name: str = Field(..., alias="full_name")
   ```

3. **–ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é**:
   ```python
   class User(BaseModel):
       name: str = Field(default="Anonymous")
   ```

4. **–ò—Å–∫–ª—é—á–µ–Ω–∏–µ –ø–æ–ª—è –∏–∑ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏**:
   ```python
   class User(BaseModel):
       password: str = Field(..., exclude=True)
   ```

---

### **–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `validator`?**

`validator` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è **–∫–∞—Å—Ç–æ–º–Ω–æ–π –ª–æ–≥–∏–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏**, –∫–æ—Ç–æ—Ä–∞—è –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤—ã—Ä–∞–∂–µ–Ω–∞ —á–µ—Ä–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã `Field`. –ù–∞–ø—Ä–∏–º–µ—Ä:
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–æ–ª–µ–π –≤–º–µ—Å—Ç–µ.
- –°–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ email).
- –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π –ø–µ—Ä–µ–¥ –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π.

#### –ü—Ä–∏–º–µ—Ä—ã:
1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–æ–ª–µ–π**:
   ```python
   from pydantic import BaseModel, validator

   class User(BaseModel):
       password: str
       confirm_password: str

       @validator('confirm_password')
       def passwords_match(cls, confirm_password, values):
           if 'password' in values and confirm_password != values['password']:
               raise ValueError('Passwords do not match')
           return confirm_password
   ```

2. **–ö–∞—Å—Ç–æ–º–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏**:
   ```python
   class User(BaseModel):
       age: int

       @validator('age')
       def check_age(cls, age):
           if age < 0:
               raise ValueError('Age must be positive')
           return age
   ```

3. **–ò–∑–º–µ–Ω–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–µ—Ä–µ–¥ –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π**:
   ```python
   class User(BaseModel):
       name: str

       @validator('name', pre=True)
       def format_name(cls, name):
           return name.title()  # –ü—Ä–∏–≤–æ–¥–∏–º –∏–º—è –∫ –∑–∞–≥–ª–∞–≤–Ω—ã–º –±—É–∫–≤–∞–º
   ```

---

### **–û—Å–Ω–æ–≤–Ω—ã–µ —Ä–∞–∑–ª–∏—á–∏—è**

| **–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞**     | **Field**                                    | **Validator**                                 |
| ---------------------- | -------------------------------------------- | --------------------------------------------- |
| **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**         | –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–ª–µ–π (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è, –∞–ª–∏–∞—Å—ã –∏ —Ç.–¥.) | –ö–∞—Å—Ç–æ–º–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏                    |
| **–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å** | –î–ª—è –ø—Ä–æ—Å—Ç—ã—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø–æ–ª–µ–π     | –î–ª—è —Å–ª–æ–∂–Ω–æ–π –ª–æ–≥–∏–∫–∏, –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–æ–ª–µ–π |
| **–ü—Ä–∏–º–µ—Ä**             | `age: int = Field(..., gt=0)`                | `@validator('age')`                           |

---

### **–ö–æ–≥–¥–∞ —á—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å?**
- **–ò—Å–ø–æ–ª—å–∑—É–π `Field`**, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ:
  - –ó–∞–¥–∞—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –∑–Ω–∞—á–µ–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ/–º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ).
  - –£–∫–∞–∑–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞–ª–∏–∞—Å—ã –¥–ª—è –ø–æ–ª–µ–π.
  - –î–æ–±–∞–≤–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ –∏–ª–∏ –ø—Ä–∏–º–µ—Ä –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏.

- **–ò—Å–ø–æ–ª—å–∑—É–π `validator`**, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ:
  - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–ª–æ–∂–Ω—É—é –ª–æ–≥–∏–∫—É –≤–∞–ª–∏–¥–∞—Ü–∏–∏.
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–ª–µ–π –≤–º–µ—Å—Ç–µ.
  - –ò–∑–º–µ–Ω–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –ø–µ—Ä–µ–¥ –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π.

---

### **–ü—Ä–∏–º–µ—Ä —Å–æ–≤–º–µ—Å—Ç–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è**
```python
from pydantic import BaseModel, Field, validator

class User(BaseModel):
    name: str = Field(..., min_length=3, max_length=50)  # –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–ª–∏–Ω—ã —Å—Ç—Ä–æ–∫–∏
    age: int = Field(..., gt=0, lt=100)  # –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–∞ –≤–æ–∑—Ä–∞—Å—Ç
    email: str

    @validator('email')
    def check_email(cls, email):
        if '@' not in email:
            raise ValueError('Invalid email format')
        return email
```

---

### **–ò—Ç–æ–≥**
- **`Field`** ‚Äî –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª–µ–π –∏ –ø—Ä–æ—Å—Ç—ã—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π.
- **`validator`** ‚Äî –¥–ª—è –∫–∞—Å—Ç–æ–º–Ω–æ–π –ª–æ–≥–∏–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏.

–ò—Å–ø–æ–ª—å–∑—É–π –∏—Ö –≤–º–µ—Å—Ç–µ, —á—Ç–æ–±—ã —Å–æ–∑–¥–∞–≤–∞—Ç—å –º–æ—â–Ω—ã–µ –∏ –≥–∏–±–∫–∏–µ –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö! üòä

# FastAPI

## 19. –ß—Ç–æ —Ç–∞–∫–æ–µ FastAPI –∏ –¥–ª—è –∫–∞–∫–∏—Ö –∑–∞–¥–∞—á –æ–Ω –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω?
**FastAPI** ‚Äî —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –±—ã—Å—Ç—Ä—ã—Ö –∏ –ø—Ä–æ—Å—Ç—ã—Ö API –Ω–∞ Python.  

### **–î–ª—è —á–µ–≥–æ?**
1. **RESTful API** –∏ **–º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã**.
2. **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏** (–±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, –≤–Ω–µ—à–Ω–∏–µ API).
3. **–ü—Ä–æ—Ç–æ—Ç–∏–ø–∏—Ä–æ–≤–∞–Ω–∏–µ** (–±—ã—Å—Ç—Ä–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞).

### **–ü–ª—é—Å—ã:**
- –í—ã—Å–æ–∫–∞—è **–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** (–∫–∞–∫ —É Node.js/Go).
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** (Swagger/ReDoc).
- –ü—Ä–æ—Å—Ç–æ—Ç–∞ –∏ **–ø–æ–¥–¥–µ—Ä–∂–∫–∞ Pydantic** –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö.
- **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å** –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç–∏.

### **–ü—Ä–∏–º–µ—Ä:**
```python
from fastapi import FastAPI

app = FastAPI()

@app.get("/")
async def root():
    return {"message": "Hello World"}
```


## 20. –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Depends –¥–ª—è –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –≤ –º–∞—Ä—à—Ä—É—Ç—ã FastAPI?
–í FastAPI **`Depends`** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –≤ –º–∞—Ä—à—Ä—É—Ç—ã. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ä–∞–∑–¥–µ–ª—è—Ç—å –ª–æ–≥–∏–∫—É, —É–ø—Ä–æ—â–∞—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–¥. –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –º–æ–≥—É—Ç –±—ã—Ç—å —Ñ—É–Ω–∫—Ü–∏—è–º–∏, –∫–ª–∞—Å—Å–∞–º–∏ –∏–ª–∏ –¥–∞–∂–µ –¥—Ä—É–≥–∏–º–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏.

---

### **–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç `Depends`?**
1. **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å** ‚Äî —ç—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è –∏–ª–∏ –∫–ª–∞—Å—Å, –∫–æ—Ç–æ—Ä—ã–π –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ.
2. **`Depends`** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–∑—ã–≤–∞–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –∏ –ø–µ—Ä–µ–¥–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –º–∞—Ä—à—Ä—É—Ç.
3. –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –º–æ–≥—É—Ç –±—ã—Ç—å **–≤–ª–æ–∂–µ–Ω–Ω—ã–º–∏** (–æ–¥–Ω–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –º–æ–∂–µ—Ç –∑–∞–≤–∏—Å–µ—Ç—å –æ—Ç –¥—Ä—É–≥–æ–π).

---

### **–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `Depends`**

#### 1. **–ü—Ä–æ—Å—Ç–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å (—Ñ—É–Ω–∫—Ü–∏—è)**
```python
from fastapi import FastAPI, Depends

app = FastAPI()

# –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å
def get_common_parameters():
    return {"message": "Hello, World!"}

# –ú–∞—Ä—à—Ä—É—Ç —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å—é
@app.get("/")
async def root(common_params: dict = Depends(get_common_parameters)):
    return common_params
```

#### 2. **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏**
```python
from fastapi import FastAPI, Depends

app = FastAPI()

# –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
def get_user(name: str, age: int):
    return {"name": name, "age": age}

# –ú–∞—Ä—à—Ä—É—Ç —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å—é
@app.get("/user/")
async def read_user(user: dict = Depends(get_user)):
    return user
```

#### 3. **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –∫–∞–∫ –∫–ª–∞—Å—Å**
```python
from fastapi import FastAPI, Depends

app = FastAPI()

# –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –∫–∞–∫ –∫–ª–∞—Å—Å
class User:
    def __init__(self, name: str, age: int):
        self.name = name
        self.age = age

# –ú–∞—Ä—à—Ä—É—Ç —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å—é
@app.get("/user/")
async def read_user(user: User = Depends(User)):
    return {"name": user.name, "age": user.age}
```

#### 4. **–í–ª–æ–∂–µ–Ω–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**
```python
from fastapi import FastAPI, Depends

app = FastAPI()

# –ü–µ—Ä–≤–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å
def get_db():
    return "Database connection"

# –í—Ç–æ—Ä–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å, –∑–∞–≤–∏—Å—è—â–∞—è –æ—Ç –ø–µ—Ä–≤–æ–π
def get_user(db: str = Depends(get_db)):
    return {"user": "John", "db": db}

# –ú–∞—Ä—à—Ä—É—Ç —Å –≤–ª–æ–∂–µ–Ω–Ω—ã–º–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏
@app.get("/user/")
async def read_user(user: dict = Depends(get_user)):
    return user
```

#### 5. **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏**
```python
from fastapi import FastAPI, Depends, HTTPException

app = FastAPI()

# –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
def authenticate(token: str):
    if token != "secret":
        raise HTTPException(status_code=401, detail="Unauthorized")
    return {"user": "John"}

# –ú–∞—Ä—à—Ä—É—Ç —Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π
@app.get("/secure/")
async def secure_route(user: dict = Depends(authenticate)):
    return {"message": f"Hello, {user['user']}!"}
```

---

### **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `Depends`**
1. **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏**:
   - –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø–æ–∑–≤–æ–ª—è—é—Ç –≤—ã–Ω–æ—Å–∏—Ç—å –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–π—Å—è –∫–æ–¥ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é) –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–ª–∏ –∫–ª–∞—Å—Å—ã.

2. **–ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**:
   - –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–∞—Ä—à—Ä—É—Ç–∞—Ö.

3. **–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å**:
   - –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ª–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ –æ—Ç –º–∞—Ä—à—Ä—É—Ç–æ–≤.

4. **–ì–∏–±–∫–æ—Å—Ç—å**:
   - –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –º–æ–≥—É—Ç –±—ã—Ç—å —Ñ—É–Ω–∫—Ü–∏—è–º–∏, –∫–ª–∞—Å—Å–∞–º–∏ –∏–ª–∏ –¥–∞–∂–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º–∏.

---

### **–ò—Ç–æ–≥**
- **`Depends`** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –≤ –º–∞—Ä—à—Ä—É—Ç—ã.
- –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –º–æ–≥—É—Ç –±—ã—Ç—å —Ñ—É–Ω–∫—Ü–∏—è–º–∏, –∫–ª–∞—Å—Å–∞–º–∏ –∏–ª–∏ –≤–ª–æ–∂–µ–Ω–Ω—ã–º–∏.
- –≠—Ç–æ —É–ø—Ä–æ—â–∞–µ—Ç –∫–æ–¥, –¥–µ–ª–∞–µ—Ç –µ–≥–æ –±–æ–ª–µ–µ –º–æ–¥—É–ª—å–Ω—ã–º –∏ —Ç–µ—Å—Ç–∏—Ä—É–µ–º—ã–º.

–ò—Å–ø–æ–ª—å–∑—É–π `Depends` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —á–∏—Å—Ç–æ–≥–æ –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ–≥–æ –∫–æ–¥–∞ –≤ FastAPI! üòä
## 21. –ß–µ–º –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –≤ FastAPI?
–í FastAPI –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –º–æ–≥—É—Ç –±—ã—Ç—å –∫–∞–∫ **—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º–∏**, —Ç–∞–∫ –∏ **–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º–∏**. –†–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É –Ω–∏–º–∏ –∑–∞–∫–ª—é—á–∞–µ—Ç—Å—è –≤ —Ç–æ–º, –∫–∞–∫ –æ–Ω–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –∏ –∫–∞–∫ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É—é—Ç —Å –¥—Ä—É–≥–∏–º–∏ —á–∞—Å—Ç—è–º–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –í–æ—Ç –æ—Å–Ω–æ–≤–Ω—ã–µ —Ä–∞–∑–ª–∏—á–∏—è:

---

### **1. –°–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å**
- **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ**: –≠—Ç–æ –æ–±—ã—á–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ (–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ).
- **–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å**:
  - –ï—Å–ª–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –≤—ã–ø–æ–ª–Ω—è–µ—Ç –±—ã—Å—Ç—Ä—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–æ—Å—Ç—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –∏–ª–∏ –¥–æ—Å—Ç—É–ø –∫ –ø–∞–º—è—Ç–∏).
  - –ï—Å–ª–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –æ–∂–∏–¥–∞–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ä–∞–±–æ—Ç–∞ —Å CPU-bound –∑–∞–¥–∞—á–∞–º–∏).

#### **–ü—Ä–∏–º–µ—Ä —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
```python
from fastapi import FastAPI, Depends

app = FastAPI()

# –°–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å
def get_sync_data():
    return {"message": "Hello, World!"}

@app.get("/sync")
async def read_sync(data: dict = Depends(get_sync_data)):
    return data
```

---

### **2. –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å**
- **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ**: –≠—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è, –æ–±—ä—è–≤–ª–µ–Ω–Ω–∞—è —Å `async def`, –∫–æ—Ç–æ—Ä–∞—è –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∑–∞–ø—Ä–æ—Å—ã –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –∏–ª–∏ –≤–Ω–µ—à–Ω–∏–º API).
- **–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å**:
  - –ï—Å–ª–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –≤—ã–ø–æ–ª–Ω—è–µ—Ç I/O-bound –∑–∞–¥–∞—á–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∑–∞–ø—Ä–æ—Å—ã –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö, HTTP-–∑–∞–ø—Ä–æ—Å—ã).
  - –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –∏–∑–±–µ–∂–∞—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.

#### **–ü—Ä–∏–º–µ—Ä –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
```python
from fastapi import FastAPI, Depends

app = FastAPI()

# –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å
async def get_async_data():
    return {"message": "Hello, Async World!"}

@app.get("/async")
async def read_async(data: dict = Depends(get_async_data)):
    return data
```

---

### **–ö–ª—é—á–µ–≤—ã–µ —Ä–∞–∑–ª–∏—á–∏—è**

| **–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞**       | **–°–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å**                  | **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å**                  |
|--------------------------|--------------------------------------------|---------------------------------------------|
| **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ**          | –û–±—ã—á–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è (`def`).                   | –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è (`async def`).          |
| **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**        | –î–ª—è –±—ã—Å—Ç—Ä—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π (CPU-bound).          | –î–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π —Å –æ–∂–∏–¥–∞–Ω–∏–µ–º (I/O-bound).       |
| **–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ—Ç–æ–∫–∞**    | –ú–æ–∂–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Ç–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.        | –ù–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –ø–æ—Ç–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.              |
| **–ü—Ä–∏–º–µ—Ä—ã –∑–∞–¥–∞—á**        | –ü—Ä–æ—Å—Ç—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è, —Ä–∞–±–æ—Ç–∞ —Å –ø–∞–º—è—Ç—å—é.      | –ó–∞–ø—Ä–æ—Å—ã –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö, HTTP-–∑–∞–ø—Ä–æ—Å—ã.        |

---

### **3. –°–º–µ—à–∞–Ω–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**
FastAPI –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ, —Ç–∞–∫ –∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤ –æ–¥–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏. –ù–∞–ø—Ä–∏–º–µ—Ä:

```python
from fastapi import FastAPI, Depends

app = FastAPI()

# –°–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å
def get_sync_data():
    return {"sync_message": "Hello, Sync World!"}

# –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å
async def get_async_data():
    return {"async_message": "Hello, Async World!"}

@app.get("/mixed")
async def read_mixed(
    sync_data: dict = Depends(get_sync_data),
    async_data: dict = Depends(get_async_data)
):
    return {**sync_data, **async_data}
```

---

### **4. –ö–æ–≥–¥–∞ —á—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å?**
- **–°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**:
  - –î–ª—è –±—ã—Å—Ç—Ä—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ —Ç—Ä–µ–±—É—é—Ç –æ–∂–∏–¥–∞–Ω–∏—è.
  - –î–ª—è CPU-bound –∑–∞–¥–∞—á (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–ª–æ–∂–Ω—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è).

- **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**:
  - –î–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π —Å –æ–∂–∏–¥–∞–Ω–∏–µ–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∑–∞–ø—Ä–æ—Å—ã –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö, –≤–Ω–µ—à–Ω–∏–µ API).
  - –î–ª—è I/O-bound –∑–∞–¥–∞—á, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø–æ—Ç–æ–∫–∞.

---

### **–ò—Ç–æ–≥**
- **–°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏** ‚Äî –¥–ª—è –±—ã—Å—Ç—Ä—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –±–µ–∑ –æ–∂–∏–¥–∞–Ω–∏—è.
- **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏** ‚Äî –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π —Å –æ–∂–∏–¥–∞–Ω–∏–µ–º, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø–æ—Ç–æ–∫–∞.

–ò—Å–ø–æ–ª—å–∑—É–π –∏—Ö –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∑–∞–¥–∞—á–∏, —á—Ç–æ–±—ã —Å–¥–µ–ª–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±–æ–ª–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–º! üòä

## 22. –ö–∞–∫ —Å–æ–∑–¥–∞—Ç—å –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å BackgroundTasks –≤ FastAPI?
–ù–µ—Ç, **`BackgroundTasks` –≤ FastAPI –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –æ—Ç–¥–µ–ª—å–Ω—ã–µ –ø–æ—Ç–æ–∫–∏** –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é. –í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ –æ–Ω –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∑–∞–¥–∞—á–∏ –≤ —Ç–æ–º –∂–µ –ø–æ—Ç–æ–∫–µ (–∏–ª–∏ event loop), —á—Ç–æ –∏ –æ—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –Ω–æ **–ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ç–≤–µ—Ç–∞ –∫–ª–∏–µ–Ω—Ç—É**. –≠—Ç–æ –≤–∞–∂–Ω–æ –ø–æ–Ω–∏–º–∞—Ç—å, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ–∂–∏–¥–∞–Ω–∏–π.

---

### **–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç `BackgroundTasks`?**

1. **–°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏**:
   - –ï—Å–ª–∏ –∑–∞–¥–∞—á–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è (–æ–±—ã—á–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è, `def`), –æ–Ω–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –ø–æ—Ç–æ–∫–µ, –Ω–æ **–ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ç–≤–µ—Ç–∞ –∫–ª–∏–µ–Ω—Ç—É**.
   - –≠—Ç–æ –º–æ–∂–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å event loop, –µ—Å–ª–∏ –∑–∞–¥–∞—á–∞ –¥–æ–ª–≥–∞—è –∏–ª–∏ CPU-bound.

2. **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏**:
   - –ï—Å–ª–∏ –∑–∞–¥–∞—á–∞ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è (`async def`), –æ–Ω–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ —Ç–æ–º –∂–µ event loop, —á—Ç–æ –∏ –æ—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.
   - –≠—Ç–æ –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç event loop, —Ç–∞–∫ –∫–∞–∫ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ –º–æ–≥—É—Ç "–æ–∂–∏–¥–∞—Ç—å" (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å –ø–æ–º–æ—â—å—é `await`).

3. **–û—Ç–¥–µ–ª—å–Ω—ã–µ –ø–æ—Ç–æ–∫–∏**:
   - –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é `BackgroundTasks` **–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –æ—Ç–¥–µ–ª—å–Ω—ã–µ –ø–æ—Ç–æ–∫–∏**. –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å CPU-bound –∑–∞–¥–∞—á–∏ –∏–ª–∏ –∑–∞–¥–∞—á–∏, –∫–æ—Ç–æ—Ä—ã–µ –±–ª–æ–∫–∏—Ä—É—é—Ç –ø–æ—Ç–æ–∫, –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **`concurrent.futures.ThreadPoolExecutor`** –∏–ª–∏ **`asyncio.to_thread`**.

---

### **–ü—Ä–∏–º–µ—Ä —Å —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –∑–∞–¥–∞—á–µ–π**

```python
from fastapi import FastAPI, BackgroundTasks
import time

app = FastAPI()

# –°–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∑–∞–¥–∞—á–∞
def sync_task(message: str):
    time.sleep(5)  # –ò–º–∏—Ç–∞—Ü–∏—è –¥–æ–ª–≥–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –∑–∞–¥–∞—á–∏
    print(f"Sync task completed: {message}")

@app.post("/sync-task/")
async def run_sync_task(message: str, background_tasks: BackgroundTasks):
    background_tasks.add_task(sync_task, message)
    return {"message": "Sync task started in the background"}
```

- **–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç**:
  - –ó–∞–¥–∞—á–∞ `sync_task` –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –ø–æ—Ç–æ–∫–µ, –Ω–æ –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ç–≤–µ—Ç–∞ –∫–ª–∏–µ–Ω—Ç—É.
  - –ï—Å–ª–∏ –∑–∞–¥–∞—á–∞ –¥–æ–ª–≥–∞—è, –æ–Ω–∞ –º–æ–∂–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å event loop.

---

### **–ü—Ä–∏–º–µ—Ä —Å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –∑–∞–¥–∞—á–µ–π**

```python
from fastapi import FastAPI, BackgroundTasks
import asyncio

app = FastAPI()

# –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∑–∞–¥–∞—á–∞
async def async_task(message: str):
    await asyncio.sleep(5)  # –ò–º–∏—Ç–∞—Ü–∏—è –¥–æ–ª–≥–æ–π –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –∑–∞–¥–∞—á–∏
    print(f"Async task completed: {message}")

@app.post("/async-task/")
async def run_async_task(message: str, background_tasks: BackgroundTasks):
    background_tasks.add_task(async_task, message)
    return {"message": "Async task started in the background"}
```

- **–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç**:
  - –ó–∞–¥–∞—á–∞ `async_task` –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ —Ç–æ–º –∂–µ event loop, —á—Ç–æ –∏ –æ—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.
  - –û–Ω–∞ –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç event loop, —Ç–∞–∫ –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `await`.

---

### **–ö–∞–∫ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∑–∞–¥–∞—á—É –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ø–æ—Ç–æ–∫–µ?**

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å CPU-bound –∑–∞–¥–∞—á—É –∏–ª–∏ –∑–∞–¥–∞—á—É, –∫–æ—Ç–æ—Ä–∞—è –±–ª–æ–∫–∏—Ä—É–µ—Ç –ø–æ—Ç–æ–∫, –∏—Å–ø–æ–ª—å–∑—É–π **`asyncio.to_thread`** –∏–ª–∏ **`concurrent.futures.ThreadPoolExecutor`**.

#### –ü—Ä–∏–º–µ—Ä —Å `asyncio.to_thread`:
```python
from fastapi import FastAPI, BackgroundTasks
import time
import asyncio

app = FastAPI()

# –°–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∑–∞–¥–∞—á–∞, –∫–æ—Ç–æ—Ä–∞—è –±–ª–æ–∫–∏—Ä—É–µ—Ç –ø–æ—Ç–æ–∫
def blocking_task(message: str):
    time.sleep(5)  # –ò–º–∏—Ç–∞—Ü–∏—è –¥–æ–ª–≥–æ–π –±–ª–æ–∫–∏—Ä—É—é—â–µ–π –∑–∞–¥–∞—á–∏
    print(f"Blocking task completed: {message}")

@app.post("/blocking-task/")
async def run_blocking_task(message: str, background_tasks: BackgroundTasks):
    background_tasks.add_task(asyncio.to_thread, blocking_task, message)
    return {"message": "Blocking task started in the background"}
```

- **–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç**:
  - –ó–∞–¥–∞—á–∞ `blocking_task` –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ø–æ—Ç–æ–∫–µ, —á—Ç–æ –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç event loop.

---

### **–ò—Ç–æ–≥**
- **`BackgroundTasks`** –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∑–∞–¥–∞—á–∏ –≤ —Ç–æ–º –∂–µ –ø–æ—Ç–æ–∫–µ (–∏–ª–∏ event loop), —á—Ç–æ –∏ –æ—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.
- –î–ª—è **—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á** —ç—Ç–æ –º–æ–∂–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å event loop.
- –î–ª—è **–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á** –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç.
- –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å CPU-bound –∏–ª–∏ –±–ª–æ–∫–∏—Ä—É—é—â—É—é –∑–∞–¥–∞—á—É, –∏—Å–ø–æ–ª—å–∑—É–π **`asyncio.to_thread`** –∏–ª–∏ **`ThreadPoolExecutor`**.

–ü—Ä–∏–º–µ—Ä —Å `asyncio.to_thread`:

```python
from fastapi import FastAPI, BackgroundTasks
import time
import asyncio

app = FastAPI()

def blocking_task(message: str):
    time.sleep(5)
    print(f"Blocking task completed: {message}")

@app.post("/blocking-task/")
async def run_blocking_task(message: str, background_tasks: BackgroundTasks):
    background_tasks.add_task(asyncio.to_thread, blocking_task, message)
    return {"message": "Blocking task started in the background"}
```

–¢–µ–ø–µ—Ä—å —Ç—ã –∑–Ω–∞–µ—à—å, –∫–∞–∫ —É–ø—Ä–∞–≤–ª—è—Ç—å —Ñ–æ–Ω–æ–≤—ã–º–∏ –∑–∞–¥–∞—á–∞–º–∏ –≤ FastAPI! üòä
## 23. –ß—Ç–æ —Ç–∞–∫–æ–µ middleware –≤ FastAPI –∏ –∫–∞–∫ –µ–≥–æ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ?
**Middleware** –≤ FastAPI ‚Äî —ç—Ç–æ —Å–ª–æ–π, –∫–æ—Ç–æ—Ä—ã–π –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –∏ –æ—Ç–≤–µ—Ç—ã –¥–æ —Ç–æ–≥–æ, –∫–∞–∫ –æ–Ω–∏ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç –º–∞—Ä—à—Ä—É—Ç–æ–≤ (endpoints) –∏–ª–∏ –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –æ–Ω–∏ –ø–æ–∫–∏–Ω—É—Ç –º–∞—Ä—à—Ä—É—Ç—ã. Middleware –ø–æ–∑–≤–æ–ª—è–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –ª–æ–≥–∏–∫—É, —Ç–∞–∫—É—é –∫–∞–∫ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫, CORS –∏ –º–Ω–æ–≥–æ–µ –¥—Ä—É–≥–æ–µ.

---

### **–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç Middleware?**
1. **–ó–∞–ø—Ä–æ—Å**:
   - Middleware –ø–æ–ª—É—á–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –¥–æ —Ç–æ–≥–æ, –∫–∞–∫ –æ–Ω –¥–æ—Å—Ç–∏–≥–Ω–µ—Ç –º–∞—Ä—à—Ä—É—Ç–∞.
   - –ú–æ–∂–µ—Ç –∏–∑–º–µ–Ω—è—Ç—å –∑–∞–ø—Ä–æ—Å –∏–ª–∏ –≤—ã–ø–æ–ª–Ω—è—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ).

2. **–û—Ç–≤–µ—Ç**:
   - Middleware –ø–æ–ª—É—á–∞–µ—Ç –æ—Ç–≤–µ—Ç –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –æ–Ω —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –º–∞—Ä—à—Ä—É—Ç–æ–º.
   - –ú–æ–∂–µ—Ç –∏–∑–º–µ–Ω—è—Ç—å –æ—Ç–≤–µ—Ç –∏–ª–∏ –≤—ã–ø–æ–ª–Ω—è—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤).

---

### **–ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å Middleware –≤ FastAPI?**

Middleware –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è —Å –ø–æ–º–æ—â—å—é –º–µ—Ç–æ–¥–∞ `.add_middleware()` –∏–ª–∏ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–∞ `@app.middleware()`.

---

### **–ü—Ä–∏–º–µ—Ä 1: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤**

```python
from fastapi import FastAPI, Request
import time

app = FastAPI()

# Middleware –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
@app.middleware("http")
async def log_middleware(request: Request, call_next):
    start_time = time.time()
    
    # –õ–æ–≥–∏—Ä—É–µ–º –∑–∞–ø—Ä–æ—Å
    print(f"Request: {request.method} {request.url}")
    
    # –ü–µ—Ä–µ–¥–∞–µ–º –∑–∞–ø—Ä–æ—Å –¥–∞–ª—å—à–µ
    response = await call_next(request)
    
    # –õ–æ–≥–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç
    process_time = time.time() - start_time
    print(f"Response: {response.status_code}, Time: {process_time:.2f}s")
    
    return response

# –ú–∞—Ä—à—Ä—É—Ç
@app.get("/")
async def root():
    return {"message": "Hello, World!"}
```

- **–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç**:
  - Middleware –ª–æ–≥–∏—Ä—É–µ—Ç –º–µ—Ç–æ–¥ –∏ URL –∑–∞–ø—Ä–æ—Å–∞, –∞ —Ç–∞–∫–∂–µ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏ —Å—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞.

---

### **–ü—Ä–∏–º–µ—Ä 2: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –≤ –æ—Ç–≤–µ—Ç**

```python
from fastapi import FastAPI, Request

app = FastAPI()

# Middleware –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
@app.middleware("http")
async def add_header_middleware(request: Request, call_next):
    response = await call_next(request)
    response.headers["X-Custom-Header"] = "Hello from Middleware"
    return response

# –ú–∞—Ä—à—Ä—É—Ç
@app.get("/")
async def root():
    return {"message": "Hello, World!"}
```

- **–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç**:
  - Middleware –¥–æ–±–∞–≤–ª—è–µ—Ç –∫–∞—Å—Ç–æ–º–Ω—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ `X-Custom-Header` –≤ –∫–∞–∂–¥—ã–π –æ—Ç–≤–µ—Ç.

---

### **–ü—Ä–∏–º–µ—Ä 3: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–≥–æ Middleware**

FastAPI –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ middleware –¥–ª—è —Ä–µ—à–µ–Ω–∏—è —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á, —Ç–∞–∫–∏—Ö –∫–∞–∫ CORS.

```python
from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware

app = FastAPI()

# –î–æ–±–∞–≤–ª—è–µ–º CORS middleware
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],  # –†–∞–∑—Ä–µ—à–∞–µ–º –≤—Å–µ –¥–æ–º–µ–Ω—ã
    allow_credentials=True,
    allow_methods=["*"],  # –†–∞–∑—Ä–µ—à–∞–µ–º –≤—Å–µ –º–µ—Ç–æ–¥—ã
    allow_headers=["*"],  # –†–∞–∑—Ä–µ—à–∞–µ–º –≤—Å–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏
)

# –ú–∞—Ä—à—Ä—É—Ç
@app.get("/")
async def root():
    return {"message": "Hello, World!"}
```

- **–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç**:
  - Middleware –¥–æ–±–∞–≤–ª—è–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É CORS, —á—Ç–æ–±—ã —Ä–∞–∑—Ä–µ—à–∏—Ç—å –∑–∞–ø—Ä–æ—Å—ã —Å –¥—Ä—É–≥–∏—Ö –¥–æ–º–µ–Ω–æ–≤.

---

### **–ü—Ä–∏–º–µ—Ä 4: –ö–∞—Å—Ç–æ–º–Ω—ã–π Middleware —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∫–ª–∞—Å—Å–∞**

Middleware –º–æ–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫–∞–∫ –∫–ª–∞—Å—Å, –µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞.

```python
from fastapi import FastAPI, Request

app = FastAPI()

# –ö–∞—Å—Ç–æ–º–Ω—ã–π Middleware –∫–∞–∫ –∫–ª–∞—Å—Å
class CustomMiddleware:
    def __init__(self, app):
        self.app = app

    async def __call__(self, scope, receive, send):
        # –õ–æ–≥–∏–∫–∞ –¥–æ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞
        print("Before request")
        
        # –ü–µ—Ä–µ–¥–∞–µ–º –∑–∞–ø—Ä–æ—Å –¥–∞–ª—å—à–µ
        await self.app(scope, receive, send)
        
        # –õ–æ–≥–∏–∫–∞ –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞
        print("After request")

# –î–æ–±–∞–≤–ª—è–µ–º Middleware
app.add_middleware(CustomMiddleware)

# –ú–∞—Ä—à—Ä—É—Ç
@app.get("/")
async def root():
    return {"message": "Hello, World!"}
```

- **–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç**:
  - Middleware –ª–æ–≥–∏—Ä—É–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –¥–æ –∏ –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞.

---

### **–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Middleware?**
1. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**:
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤.
2. **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è**:
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–æ–≤ –∏–ª–∏ –¥—Ä—É–≥–∏—Ö –¥–∞–Ω–Ω—ã—Ö –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏.
3. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**:
   - –ü–µ—Ä–µ—Ö–≤–∞—Ç –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π.
4. **CORS**:
   - –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ —Å –¥—Ä—É–≥–∏—Ö –¥–æ–º–µ–Ω–æ–≤.
5. **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤**:
   - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –≤ –æ—Ç–≤–µ—Ç—ã.

---

### **–ò—Ç–æ–≥**
- **Middleware** ‚Äî —ç—Ç–æ —Å–ª–æ–π, –∫–æ—Ç–æ—Ä—ã–π –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –∏ –æ—Ç–≤–µ—Ç—ã.
- –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å —á–µ—Ä–µ–∑ `.add_middleware()` –∏–ª–∏ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä `@app.middleware()`.
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è, –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏, CORS –∏ –¥—Ä—É–≥–∏—Ö –∑–∞–¥–∞—á.

–ü—Ä–∏–º–µ—Ä —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º:

```python
from fastapi import FastAPI, Request
import time

app = FastAPI()

@app.middleware("http")
async def log_middleware(request: Request, call_next):
    start_time = time.time()
    print(f"Request: {request.method} {request.url}")
    response = await call_next(request)
    process_time = time.time() - start_time
    print(f"Response: {response.status_code}, Time: {process_time:.2f}s")
    return response

@app.get("/")
async def root():
    return {"message": "Hello, World!"}
```

–¢–µ–ø–µ—Ä—å —Ç—ã –∑–Ω–∞–µ—à—å, –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Middleware –≤ FastAPI! üòä
## 24. –ö–∞–∫ middleware –≤ FastAPI –º–æ–∂–µ—Ç –≤–ª–∏—è—Ç—å –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤?
Middleware –≤ FastAPI –º–æ–∂–µ—Ç:
1. **–ò–∑–º–µ–Ω—è—Ç—å –∑–∞–ø—Ä–æ—Å—ã**: –î–æ–±–∞–≤–ª—è—Ç—å –¥–∞–Ω–Ω—ã–µ, –ø—Ä–æ–≤–µ—Ä—è—Ç—å –∑–∞–≥–æ–ª–æ–≤–∫–∏, –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å.
2. **–ò–∑–º–µ–Ω—è—Ç—å –æ—Ç–≤–µ—Ç—ã**: –î–æ–±–∞–≤–ª—è—Ç—å –∑–∞–≥–æ–ª–æ–≤–∫–∏, —Å–∂–∏–º–∞—Ç—å –¥–∞–Ω–Ω—ã–µ, –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å.
3. **–ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—Ç—å –æ—à–∏–±–∫–∏**: –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏—è –¥–æ –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ç–≤–µ—Ç–∞.
4. **–ë–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã**: –ù–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ö–æ—Å—Ç–µ –∏–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏.

–ü—Ä–∏–º–µ—Ä: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤.

```python
@app.middleware("http")
async def log_middleware(request: Request, call_next):
    print(f"Request: {request.method} {request.url}")
    response = await call_next(request)
    print(f"Response: {response.status_code}")
    return response
``` 

Middleware ‚Äî —ç—Ç–æ –º–æ—â–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –ª–æ–≥–∏–∫–∏ –≤ –æ–±—Ä–∞–±–æ—Ç–∫—É –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤. üòä
## 25. –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Pydantic –º–æ–¥–µ–ª–∏ –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤ –≤ FastAPI?
–í FastAPI **Pydantic –º–æ–¥–µ–ª–∏** –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤. –≠—Ç–æ –¥–µ–ª–∞–µ—Ç –∫–æ–¥ —á–∏—â–µ, –±–µ–∑–æ–ø–∞—Å–Ω–µ–µ –∏ —É–¥–æ–±–Ω–µ–µ. –í–æ—Ç –∫–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:

---

### **1. –í–∞–ª–∏–¥–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤**
Pydantic –º–æ–¥–µ–ª–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö, –ø–µ—Ä–µ–¥–∞–≤–∞–µ–º—ã—Ö –≤ –∑–∞–ø—Ä–æ—Å–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ —Ç–µ–ª–µ POST-–∑–∞–ø—Ä–æ—Å–∞).

#### –ü—Ä–∏–º–µ—Ä:
```python
from fastapi import FastAPI
from pydantic import BaseModel

app = FastAPI()

# –ú–æ–¥–µ–ª—å –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–∞
class Item(BaseModel):
    name: str
    description: str = None
    price: float
    tax: float = None

# –ú–∞—Ä—à—Ä—É—Ç —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –∑–∞–ø—Ä–æ—Å–∞
@app.post("/items/")
async def create_item(item: Item):
    return item
```

- **–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç**:
  - FastAPI –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç —Ç–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞ —Å –ø–æ–º–æ—â—å—é –º–æ–¥–µ–ª–∏ `Item`.
  - –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –º–æ–¥–µ–ª–∏, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –æ—à–∏–±–∫–∞ `422 Unprocessable Entity`.

---

### **2. –í–∞–ª–∏–¥–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–æ–≤**
Pydantic –º–æ–¥–µ–ª–∏ —Ç–∞–∫–∂–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã—Ö –≤ –æ—Ç–≤–µ—Ç–µ.

#### –ü—Ä–∏–º–µ—Ä:
```python
from fastapi import FastAPI
from pydantic import BaseModel

app = FastAPI()

# –ú–æ–¥–µ–ª—å –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–∞
class User(BaseModel):
    username: str
    email: str
    age: int

# –ú–∞—Ä—à—Ä—É—Ç —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –æ—Ç–≤–µ—Ç–∞
@app.get("/user/", response_model=User)
async def read_user():
    return {"username": "john", "email": "john@example.com", "age": 30}
```

- **–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç**:
  - FastAPI –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –æ—Ç–≤–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –º–æ–¥–µ–ª–∏ `User`.
  - –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –º–æ–¥–µ–ª–∏, –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –æ—à–∏–±–∫–∞.

---

### **3. –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∑–∞–ø—Ä–æ—Å–∞**
Pydantic –º–æ–¥–µ–ª–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∑–∞–ø—Ä–æ—Å–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, query-–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤).

#### –ü—Ä–∏–º–µ—Ä:
```python
from fastapi import FastAPI
from pydantic import BaseModel

app = FastAPI()

# –ú–æ–¥–µ–ª—å –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ query-–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
class Filter(BaseModel):
    limit: int
    offset: int = 0

# –ú–∞—Ä—à—Ä—É—Ç —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π query-–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
@app.get("/items/")
async def read_items(filter: Filter):
    return {"limit": filter.limit, "offset": filter.offset}
```

- **–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç**:
  - FastAPI –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç query-–ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å –ø–æ–º–æ—â—å—é –º–æ–¥–µ–ª–∏ `Filter`.

---

### **4. –í–ª–æ–∂–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏**
Pydantic –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏, —á—Ç–æ –ø–æ–ª–µ–∑–Ω–æ –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.

#### –ü—Ä–∏–º–µ—Ä:
```python
from fastapi import FastAPI
from pydantic import BaseModel

app = FastAPI()

# –í–ª–æ–∂–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å
class Address(BaseModel):
    city: str
    street: str

# –û—Å–Ω–æ–≤–Ω–∞—è –º–æ–¥–µ–ª—å
class User(BaseModel):
    name: str
    address: Address

# –ú–∞—Ä—à—Ä—É—Ç —Å –≤–ª–æ–∂–µ–Ω–Ω–æ–π –º–æ–¥–µ–ª—å—é
@app.post("/user/")
async def create_user(user: User):
    return user
```

- **–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç**:
  - FastAPI –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `address` –≤–Ω—É—Ç—Ä–∏ `user`).

---

### **5. –ö–∞—Å—Ç–æ–º–Ω—ã–µ –≤–∞–ª–∏–¥–∞—Ç–æ—Ä—ã**
Pydantic –ø–æ–∑–≤–æ–ª—è–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å –∫–∞—Å—Ç–æ–º–Ω—ã–µ –≤–∞–ª–∏–¥–∞—Ç–æ—Ä—ã –¥–ª—è –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω–æ–π –ª–æ–≥–∏–∫–∏.

#### –ü—Ä–∏–º–µ—Ä:
```python
from fastapi import FastAPI
from pydantic import BaseModel, validator

app = FastAPI()

# –ú–æ–¥–µ–ª—å —Å –∫–∞—Å—Ç–æ–º–Ω—ã–º –≤–∞–ª–∏–¥–∞—Ç–æ—Ä–æ–º
class Item(BaseModel):
    name: str
    price: float

    @validator('price')
    def price_must_be_positive(cls, value):
        if value < 0:
            raise ValueError('Price must be positive')
        return value

# –ú–∞—Ä—à—Ä—É—Ç —Å –∫–∞—Å—Ç–æ–º–Ω–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
@app.post("/items/")
async def create_item(item: Item):
    return item
```

- **–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç**:
  - –ï—Å–ª–∏ `price` –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –æ—à–∏–±–∫–∞ `422 Unprocessable Entity`.

---

### **–ò—Ç–æ–≥**
- **Pydantic –º–æ–¥–µ–ª–∏** –≤ FastAPI –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤, –æ—Ç–≤–µ—Ç–æ–≤ –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤.
- –û–Ω–∏ –¥–µ–ª–∞—é—Ç –∫–æ–¥ –±–µ–∑–æ–ø–∞—Å–Ω—ã–º, —á–∏—Å—Ç—ã–º –∏ —É–¥–æ–±–Ω—ã–º.
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏ –∏ –∫–∞—Å—Ç–æ–º–Ω—ã–µ –≤–∞–ª–∏–¥–∞—Ç–æ—Ä—ã.

–ü—Ä–∏–º–µ—Ä:

```python
from fastapi import FastAPI
from pydantic import BaseModel

app = FastAPI()

class Item(BaseModel):
    name: str
    price: float

@app.post("/items/")
async def create_item(item: Item):
    return item
```

–¢–µ–ø–µ—Ä—å —Ç—ã –∑–Ω–∞–µ—à—å, –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Pydantic –º–æ–¥–µ–ª–∏ –≤ FastAPI! üòä
## 26. –ö–∞–∫ –≤ FastAPI —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–∏—Å—Ç–µ–º–∞ –º–∞—Ä—à—Ä—É—Ç–æ–≤ –∏ –∫–∞–∫ –º–æ–∂–Ω–æ –∑–∞–¥–∞–≤–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ –ø—É—Ç–∏?
–í FastAPI —Å–∏—Å—Ç–µ–º–∞ –º–∞—Ä—à—Ä—É—Ç–æ–≤ (routing) –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å, –∫–∞–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç HTTP-–∑–∞–ø—Ä–æ—Å—ã. –ú–∞—Ä—à—Ä—É—Ç—ã –∑–∞–¥–∞—é—Ç—Å—è —Å –ø–æ–º–æ—â—å—é –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–æ–≤, —Ç–∞–∫–∏—Ö –∫–∞–∫ `@app.get()`, `@app.post()`, –∏ —Ç.–¥. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ –ø—É—Ç–∏ (path parameters) –ø–æ–∑–≤–æ–ª—è—é—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∑–Ω–∞—á–µ–Ω–∏–π, –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã—Ö –≤ URL.

---

### **–ö–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç –º–∞—Ä—à—Ä—É—Ç—ã –≤ FastAPI?**

1. **–î–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã**:
   - –ú–∞—Ä—à—Ä—É—Ç—ã –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è —Å –ø–æ–º–æ—â—å—é –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–æ–≤, –Ω–∞–ø—Ä–∏–º–µ—Ä:
     - `@app.get("/path")` ‚Äî –¥–ª—è GET-–∑–∞–ø—Ä–æ—Å–æ–≤.
     - `@app.post("/path")` ‚Äî –¥–ª—è POST-–∑–∞–ø—Ä–æ—Å–æ–≤.
     - `@app.put("/path")` ‚Äî –¥–ª—è PUT-–∑–∞–ø—Ä–æ—Å–æ–≤.
     - `@app.delete("/path")` ‚Äî –¥–ª—è DELETE-–∑–∞–ø—Ä–æ—Å–æ–≤.

2. **–§—É–Ω–∫—Ü–∏–∏-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏**:
   - –ö–∞–∂–¥—ã–π –º–∞—Ä—à—Ä—É—Ç —Å–≤—è–∑–∞–Ω —Å —Ñ—É–Ω–∫—Ü–∏–µ–π, –∫–æ—Ç–æ—Ä–∞—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—Ç–≤–µ—Ç.

3. **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ –ø—É—Ç–∏**:
   - –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ –ø—É—Ç–∏ –ø–æ–∑–≤–æ–ª—è—é—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã. –û–Ω–∏ —É–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –≤ —Ñ–∏–≥—É—Ä–Ω—ã—Ö —Å–∫–æ–±–∫–∞—Ö `{}` –≤ URL.

---

### **–ö–∞–∫ –∑–∞–¥–∞–≤–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ –ø—É—Ç–∏?**

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ –ø—É—Ç–∏ –∑–∞–¥–∞—é—Ç—Å—è —Å –ø–æ–º–æ—â—å—é —Ñ–∏–≥—É—Ä–Ω—ã—Ö —Å–∫–æ–±–æ–∫ `{}` –≤ URL. FastAPI –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑–≤–ª–µ–∫–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è –∏ –ø–µ—Ä–µ–¥–∞–µ—Ç –∏—Ö –≤ —Ñ—É–Ω–∫—Ü–∏—é-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫.

#### –ü—Ä–∏–º–µ—Ä 1: –ü—Ä–æ—Å—Ç–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä
```python
from fastapi import FastAPI

app = FastAPI()

# –ú–∞—Ä—à—Ä—É—Ç —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º –≤ –ø—É—Ç–∏
@app.get("/items/{item_id}")
async def read_item(item_id: int):
    return {"item_id": item_id}
```

- **–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç**:
  - –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å–∏—Ç—å `/items/42`, FastAPI –ø–µ—Ä–µ–¥–∞—Å—Ç `item_id=42` –≤ —Ñ—É–Ω–∫—Ü–∏—é `read_item`.
  - –ü–∞—Ä–∞–º–µ—Ç—Ä `item_id` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç—Å—è –≤ `int` (–µ—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ).

---

#### –ü—Ä–∏–º–µ—Ä 2: –ù–µ—Å–∫–æ–ª—å–∫–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
```python
from fastapi import FastAPI

app = FastAPI()

# –ú–∞—Ä—à—Ä—É—Ç —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
@app.get("/users/{user_id}/items/{item_id}")
async def read_user_item(user_id: int, item_id: int):
    return {"user_id": user_id, "item_id": item_id}
```

- **–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç**:
  - –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å–∏—Ç—å `/users/1/items/42`, FastAPI –ø–µ—Ä–µ–¥–∞—Å—Ç `user_id=1` –∏ `item_id=42` –≤ —Ñ—É–Ω–∫—Ü–∏—é `read_user_item`.

---

#### –ü—Ä–∏–º–µ—Ä 3: –ü–∞—Ä–∞–º–µ—Ç—Ä —Å —Ç–∏–ø–æ–º –¥–∞–Ω–Ω—ã—Ö
FastAPI –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ –ø—É—Ç–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–π —Ç–∏–ø–æ–≤.

```python
from fastapi import FastAPI

app = FastAPI()

# –ü–∞—Ä–∞–º–µ—Ç—Ä —Å —Ç–∏–ø–æ–º –¥–∞–Ω–Ω—ã—Ö
@app.get("/items/{item_id}")
async def read_item(item_id: int):
    return {"item_id": item_id}
```

- **–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç**:
  - –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å–∏—Ç—å `/items/abc`, FastAPI –≤–µ—Ä–Ω–µ—Ç –æ—à–∏–±–∫—É `422 Unprocessable Entity`, —Ç–∞–∫ –∫–∞–∫ `abc` –Ω–µ–ª—å–∑—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –≤ `int`.

---

#### –ü—Ä–∏–º–µ—Ä 4: –ü–∞—Ä–∞–º–µ—Ç—Ä —Å —Ä–µ–≥—É–ª—è—Ä–Ω—ã–º –≤—ã—Ä–∞–∂–µ–Ω–∏–µ–º
–ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞.

```python
from fastapi import FastAPI

app = FastAPI()

# –ü–∞—Ä–∞–º–µ—Ç—Ä —Å —Ä–µ–≥—É–ª—è—Ä–Ω—ã–º –≤—ã—Ä–∞–∂–µ–Ω–∏–µ–º
@app.get("/items/{item_id:^\\d+$}")
async def read_item(item_id: int):
    return {"item_id": item_id}
```

- **–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç**:
  - –ü–∞—Ä–∞–º–µ—Ç—Ä `item_id` –¥–æ–ª–∂–µ–Ω —Å–æ—Å—Ç–æ—è—Ç—å —Ç–æ–ª—å–∫–æ –∏–∑ —Ü–∏—Ñ—Ä (`\d+`).

---

#### –ü—Ä–∏–º–µ—Ä 5: –ü–∞—Ä–∞–º–µ—Ç—Ä —Å —Ç–∏–ø–æ–º `str` –∏ –∑–Ω–∞—á–µ–Ω–∏–µ–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
–ï—Å–ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π, –º–æ–∂–Ω–æ –∑–∞–¥–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.

```python
from fastapi import FastAPI

app = FastAPI()

# –ü–∞—Ä–∞–º–µ—Ç—Ä —Å —Ç–∏–ø–æ–º `str` –∏ –∑–Ω–∞—á–µ–Ω–∏–µ–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
@app.get("/items/{item_id}")
async def read_item(item_id: str = "default"):
    return {"item_id": item_id}
```

- **–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç**:
  - –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å–∏—Ç—å `/items/`, FastAPI –≤–µ—Ä–Ω–µ—Ç `{"item_id": "default"}`.

---

### **–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–∏—Å—Ç–µ–º–∞ –º–∞—Ä—à—Ä—É—Ç–æ–≤?**

1. **–°–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ URL**:
   - FastAPI —Å–æ–ø–æ—Å—Ç–∞–≤–ª—è–µ—Ç URL –∑–∞–ø—Ä–æ—Å–∞ —Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–º–∏ –º–∞—Ä—à—Ä—É—Ç–∞–º–∏.
   - –ï—Å–ª–∏ –º–∞—Ä—à—Ä—É—Ç –Ω–∞–π–¥–µ–Ω, –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∞—è —Ñ—É–Ω–∫—Ü–∏—è.

2. **–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤**:
   - –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑–≤–ª–µ–∫–∞—é—Ç—Å—è –∏–∑ URL –∏ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ —Ñ—É–Ω–∫—Ü–∏—é.

3. **–í–∞–ª–∏–¥–∞—Ü–∏—è**:
   - –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–∞–ª–∏–¥–∏—Ä—É—é—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–π —Ç–∏–ø–æ–≤.

4. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏**:
   - FastAPI –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é Swagger –∏ ReDoc –Ω–∞ –æ—Å–Ω–æ–≤–µ –º–∞—Ä—à—Ä—É—Ç–æ–≤.

---

### **–ò—Ç–æ–≥**
- **–ú–∞—Ä—à—Ä—É—Ç—ã** –∑–∞–¥–∞—é—Ç—Å—è —Å –ø–æ–º–æ—â—å—é –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–æ–≤ (`@app.get()`, `@app.post()` –∏ —Ç.–¥.).
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ –ø—É—Ç–∏** —É–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –≤ —Ñ–∏–≥—É—Ä–Ω—ã—Ö —Å–∫–æ–±–∫–∞—Ö `{}` –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ —Ñ—É–Ω–∫—Ü–∏—é.
- FastAPI –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é.

–ü—Ä–∏–º–µ—Ä:

```python
from fastapi import FastAPI

app = FastAPI()

@app.get("/items/{item_id}")
async def read_item(item_id: int):
    return {"item_id": item_id}
```


## 27. –ö–∞–∫ —É–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º —Å–µ—Å—Å–∏–∏ –≤ FastAPI (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ state)?
`app.state` –≤ FastAPI –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è **–≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è**, –∫–æ—Ç–æ—Ä–æ–µ –¥–æ—Å—Ç—É–ø–Ω–æ –≤—Å–µ–º –º–∞—Ä—à—Ä—É—Ç–∞–º –∏ middleware. –≠—Ç–æ –ø–æ–ª–µ–∑–Ω–æ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã –Ω–∞ –ø—Ä–æ—Ç—è–∂–µ–Ω–∏–∏ –≤—Å–µ–≥–æ –∂–∏–∑–Ω–µ–Ω–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, —Ç–∞–∫–∏—Ö –∫–∞–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–∞–º –¥–∞–Ω–Ω—ã—Ö, –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏, –∫—ç—à–∏ –∏–ª–∏ –ª—é–±—ã–µ –¥—Ä—É–≥–∏–µ –æ–±—â–∏–µ —Ä–µ—Å—É—Ä—Å—ã.

---

### **–ü—Ä–∏–º–µ—Ä—ã —Ä–µ–∞–ª—å–Ω–æ–≥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è `app.state`**

#### 1. **–•—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö**
`app.state` —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞.

```python
from fastapi import FastAPI, Depends
from sqlalchemy import create_engine
from sqlalchemy.orm import sessionmaker, Session

app = FastAPI()

# –°–æ–∑–¥–∞–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
DATABASE_URL = "sqlite:///./test.db"
engine = create_engine(DATABASE_URL)
SessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)

# –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≤ app.state
app.state.db_engine = engine
app.state.db_session = SessionLocal

# –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–µ—Å—Å–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
def get_db():
    db = app.state.db_session()
    try:
        yield db
    finally:
        db.close()

@app.get("/items/")
async def read_items(db: Session = Depends(get_db)):
    items = db.query(Item).all()
    return {"items": items}
```

- **–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç**:
  - –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö —Å–æ–∑–¥–∞–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `app.state`.
  - –î–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ —Å–æ–∑–¥–∞–µ—Ç—Å—è –Ω–æ–≤–∞—è —Å–µ—Å—Å–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞.

---

#### 2. **–•—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏**
`app.state` –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –Ω–∞–ø—Ä–∏–º–µ—Ä, API-–∫–ª—é—á–µ–π –∏–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫.

```python
from fastapi import FastAPI

app = FastAPI()

# –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≤ app.state
app.state.config = {
    "api_key": "your-api-key",
    "max_requests": 100,
}

@app.get("/config/")
async def get_config():
    return {"config": app.state.config}
```

- **–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç**:
  - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ `app.state` –∏ –¥–æ—Å—Ç—É–ø–Ω–∞ –≤—Å–µ–º –º–∞—Ä—à—Ä—É—Ç–∞–º.

---

#### 3. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö**
`app.state` –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π –∏–ª–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –≤–Ω–µ—à–Ω–∏–º API.

```python
from fastapi import FastAPI

app = FastAPI()

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫—ç—à –≤ app.state
app.state.cache = {}

@app.get("/cached-data/")
async def get_cached_data():
    if "data" not in app.state.cache:
        # –ò–º–∏—Ç–∞—Ü–∏—è –¥–æ–ª–≥–æ–≥–æ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –∏–ª–∏ –∑–∞–ø—Ä–æ—Å–∞
        app.state.cache["data"] = {"result": "cached data"}
    return app.state.cache["data"]
```

- **–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç**:
  - –î–∞–Ω–Ω—ã–µ –∫—ç—à–∏—Ä—É—é—Ç—Å—è –≤ `app.state.cache` –∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤.

---

#### 4. **–•—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –≤–Ω–µ—à–Ω–µ–º—É —Å–µ—Ä–≤–∏—Å—É**
`app.state` –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –≤–Ω–µ—à–Ω–µ–º—É —Å–µ—Ä–≤–∏—Å—É, –Ω–∞–ø—Ä–∏–º–µ—Ä, Redis –∏–ª–∏ RabbitMQ.

```python
from fastapi import FastAPI
import redis

app = FastAPI()

# –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ Redis –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≤ app.state
app.state.redis = redis.Redis(host="localhost", port=6379, db=0)

@app.get("/redis/")
async def get_redis_data(key: str):
    value = app.state.redis.get(key)
    return {"key": key, "value": value}
```

- **–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç**:
  - –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Redis —Å–æ–∑–¥–∞–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `app.state`.
  - –í—Å–µ –º–∞—Ä—à—Ä—É—Ç—ã –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Redis.

---

#### 5. **–•—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è**
`app.state` –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –Ω–∞–ø—Ä–∏–º–µ—Ä, —Å—á–µ—Ç—á–∏–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤.

```python
from fastapi import FastAPI

app = FastAPI()

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å—á–µ—Ç—á–∏–∫ –∑–∞–ø—Ä–æ—Å–æ–≤
app.state.request_count = 0

@app.get("/request-count/")
async def get_request_count():
    app.state.request_count += 1
    return {"request_count": app.state.request_count}
```

- **–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç**:
  - –°—á–µ—Ç—á–∏–∫ –∑–∞–ø—Ä–æ—Å–æ–≤ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ `app.state` –∏ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ.

---

### **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `app.state`**
1. **–ì–ª–æ–±–∞–ª—å–Ω—ã–π –¥–æ—Å—Ç—É–ø**:
   - –î–∞–Ω–Ω—ã–µ –¥–æ—Å—Ç—É–ø–Ω—ã –≤—Å–µ–º –º–∞—Ä—à—Ä—É—Ç–∞–º –∏ middleware.
2. **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å**:
   - –†–µ—Å—É—Ä—Å—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø–æ–≤—Ç–æ—Ä–Ω–æ.
3. **–ü—Ä–æ—Å—Ç–æ—Ç–∞**:
   - –ù–µ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ—É–Ω–∫—Ü–∏–π.

---

### **–ò—Ç–æ–≥**
`app.state` –≤ FastAPI –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, —Ç–∞–∫–æ–≥–æ –∫–∞–∫:
- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–∞–º –¥–∞–Ω–Ω—ã—Ö.
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.
- –ö—ç—à–∏.
- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –≤–Ω–µ—à–Ω–∏–º —Å–µ—Ä–≤–∏—Å–∞–º.
- –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

–ü—Ä–∏–º–µ—Ä —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö:

```python
from fastapi import FastAPI, Depends
from sqlalchemy import create_engine
from sqlalchemy.orm import sessionmaker, Session

app = FastAPI()

DATABASE_URL = "sqlite:///./test.db"
engine = create_engine(DATABASE_URL)
SessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)

app.state.db_engine = engine
app.state.db_session = SessionLocal

def get_db():
    db = app.state.db_session()
    try:
        yield db
    finally:
        db.close()

@app.get("/items/")
async def read_items(db: Session = Depends(get_db)):
    items = db.query(Item).all()
    return {"items": items}
```


## 28. –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä @app.exception_handler –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–π?
–î–µ–∫–æ—Ä–∞—Ç–æ—Ä **`@app.exception_handler`** –≤ FastAPI –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—Ç—å –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏—è –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –≠—Ç–æ –ø–æ–ª–µ–∑–Ω–æ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ –æ—à–∏–±–∫–∏, —Ç–∞–∫–∏—Ö –∫–∞–∫ `404 Not Found` –∏–ª–∏ `500 Internal Server Error`.

---

### **–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç `@app.exception_handler`?**

1. **–ü–µ—Ä–µ—Ö–≤–∞—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏–π**:
   - –î–µ–∫–æ—Ä–∞—Ç–æ—Ä `@app.exception_handler` –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞.
   - –ú–æ–∂–Ω–æ –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—Ç—å –∫–∞–∫ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, `HTTPException`), —Ç–∞–∫ –∏ –∫–∞—Å—Ç–æ–º–Ω—ã–µ.

2. **–ö–∞—Å—Ç–æ–º–Ω—ã–π –æ—Ç–≤–µ—Ç**:
   - –í –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ –º–æ–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å –∫–∞—Å—Ç–æ–º–Ω—ã–π –æ—Ç–≤–µ—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, JSON —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –æ—à–∏–±–∫–∏).

---

### **–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è**

#### 1. **–û–±—Ä–∞–±–æ—Ç–∫–∞ `HTTPException`**
FastAPI –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç `HTTPException` –¥–ª—è –æ—à–∏–±–æ–∫, —Ç–∞–∫–∏—Ö –∫–∞–∫ `404 Not Found`. –ú–æ–∂–Ω–æ –ø–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å —ç—Ç–æ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –∏ –≤–µ—Ä–Ω—É—Ç—å –∫–∞—Å—Ç–æ–º–Ω—ã–π –æ—Ç–≤–µ—Ç.

```python
from fastapi import FastAPI, HTTPException, Request
from fastapi.responses import JSONResponse

app = FastAPI()

# –ö–∞—Å—Ç–æ–º–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è HTTPException
@app.exception_handler(HTTPException)
async def http_exception_handler(request: Request, exc: HTTPException):
    return JSONResponse(
        status_code=exc.status_code,
        content={"message": f"Oops! {exc.detail}"},
    )

@app.get("/items/{item_id}")
async def read_item(item_id: int):
    if item_id == 42:
        raise HTTPException(status_code=404, detail="Item not found")
    return {"item_id": item_id}
```

- **–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç**:
  - –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å–∏—Ç—å `/items/42`, –±—É–¥–µ—Ç –≤—ã–∑–≤–∞–Ω–æ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ `HTTPException`.
  - –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤–µ—Ä–Ω–µ—Ç –∫–∞—Å—Ç–æ–º–Ω—ã–π JSON-–æ—Ç–≤–µ—Ç: `{"message": "Oops! Item not found"}`.

---

#### 2. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –∏—Å–∫–ª—é—á–µ–Ω–∏–π**
–ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –∏ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –µ–≥–æ.

```python
from fastapi import FastAPI, Request
from fastapi.responses import JSONResponse

app = FastAPI()

# –ö–∞—Å—Ç–æ–º–Ω–æ–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ
class CustomException(Exception):
    def __init__(self, message: str):
        self.message = message

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ –∏—Å–∫–ª—é—á–µ–Ω–∏—è
@app.exception_handler(CustomException)
async def custom_exception_handler(request: Request, exc: CustomException):
    return JSONResponse(
        status_code=400,
        content={"message": f"Custom error: {exc.message}"},
    )

@app.get("/custom-error/")
async def trigger_custom_error():
    raise CustomException(message="Something went wrong!")
```

- **–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç**:
  - –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å–∏—Ç—å `/custom-error/`, –±—É–¥–µ—Ç –≤—ã–∑–≤–∞–Ω–æ –∫–∞—Å—Ç–æ–º–Ω–æ–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ.
  - –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤–µ—Ä–Ω–µ—Ç JSON-–æ—Ç–≤–µ—Ç: `{"message": "Custom error: Something went wrong!"}`.

---

#### 3. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö –∏—Å–∫–ª—é—á–µ–Ω–∏–π**
–ú–æ–∂–Ω–æ –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—Ç—å –≤—Å–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è —Å –ø–æ–º–æ—â—å—é `Exception`.

```python
from fastapi import FastAPI, Request
from fastapi.responses import JSONResponse

app = FastAPI()

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –≤—Å–µ—Ö –∏—Å–∫–ª—é—á–µ–Ω–∏–π
@app.exception_handler(Exception)
async def generic_exception_handler(request: Request, exc: Exception):
    return JSONResponse(
        status_code=500,
        content={"message": "Internal Server Error"},
    )

@app.get("/error/")
async def trigger_error():
    raise ValueError("Something went wrong!")
```

- **–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç**:
  - –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å–∏—Ç—å `/error/`, –±—É–¥–µ—Ç –≤—ã–∑–≤–∞–Ω–æ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ `ValueError`.
  - –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤–µ—Ä–Ω–µ—Ç JSON-–æ—Ç–≤–µ—Ç: `{"message": "Internal Server Error"}`.

---

#### 4. **–û–±—Ä–∞–±–æ—Ç–∫–∞ `RequestValidationError`**
FastAPI –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç `RequestValidationError`, –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å–∞ –Ω–µ –ø—Ä–æ—Ö–æ–¥—è—Ç –≤–∞–ª–∏–¥–∞—Ü–∏—é. –ú–æ–∂–Ω–æ –ø–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å —ç—Ç–æ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –∏ –≤–µ—Ä–Ω—É—Ç—å –∫–∞—Å—Ç–æ–º–Ω—ã–π –æ—Ç–≤–µ—Ç.

```python
from fastapi import FastAPI, Request, status
from fastapi.responses import JSONResponse
from fastapi.exceptions import RequestValidationError

app = FastAPI()

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è RequestValidationError
@app.exception_handler(RequestValidationError)
async def validation_exception_handler(request: Request, exc: RequestValidationError):
    return JSONResponse(
        status_code=status.HTTP_422_UNPROCESSABLE_ENTITY,
        content={"message": "Validation error", "details": exc.errors()},
    )

@app.post("/items/")
async def create_item(item: dict):
    return {"item": item}
```

- **–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç**:
  - –ï—Å–ª–∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ `/items/`, –±—É–¥–µ—Ç –≤—ã–∑–≤–∞–Ω–æ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ `RequestValidationError`.
  - –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤–µ—Ä–Ω–µ—Ç JSON-–æ—Ç–≤–µ—Ç —Å –¥–µ—Ç–∞–ª—è–º–∏ –æ—à–∏–±–∫–∏.

---

### **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `@app.exception_handler`**
1. **–ö–∞—Å—Ç–æ–º–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã**:
   - –ú–æ–∂–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –∫–∞—Å—Ç–æ–º–Ω—ã–µ JSON-–æ—Ç–≤–µ—Ç—ã –∏–ª–∏ HTML-—Å—Ç—Ä–∞–Ω–∏—Ü—ã.
2. **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**:
   - –í—Å–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ.
3. **–ì–∏–±–∫–æ—Å—Ç—å**:
   - –ú–æ–∂–Ω–æ –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—Ç—å –∫–∞–∫ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ, —Ç–∞–∫ –∏ –∫–∞—Å—Ç–æ–º–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è.

---

### **–ò—Ç–æ–≥**
- **`@app.exception_handler`** –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—Ç—å –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏—è –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
- –ú–æ–∂–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, `HTTPException`, `RequestValidationError`) –∏ –∫–∞—Å—Ç–æ–º–Ω—ã–µ.
- –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–∞—Å—Ç–æ–º–Ω—ã–π –æ—Ç–≤–µ—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, JSON).

–ü—Ä–∏–º–µ—Ä —Å `HTTPException`:

```python
from fastapi import FastAPI, HTTPException, Request
from fastapi.responses import JSONResponse

app = FastAPI()

@app.exception_handler(HTTPException)
async def http_exception_handler(request: Request, exc: HTTPException):
    return JSONResponse(
        status_code=exc.status_code,
        content={"message": f"Oops! {exc.detail}"},
    )

@app.get("/items/{item_id}")
async def read_item(item_id: int):
    if item_id == 42:
        raise HTTPException(status_code=404, detail="Item not found")
    return {"item_id": item_id}
```

–¢–µ–ø–µ—Ä—å —Ç—ã –∑–Ω–∞–µ—à—å, –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `@app.exception_handler` –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–π –≤ FastAPI! üòä

## 29. –ß—Ç–æ —Ç–∞–∫–æ–µ lifespan —Å–æ–±—ã—Ç–∏—è –≤ FastAPI –∏ –∫–∞–∫ –∏—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å?
**Lifespan —Å–æ–±—ã—Ç–∏—è** –≤ FastAPI ‚Äî —ç—Ç–æ –º–µ—Ö–∞–Ω–∏–∑–º –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–¥–∞ –ø—Ä–∏ **–∑–∞–ø—É—Å–∫–µ** –∏ **–∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏** —Ä–∞–±–æ—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –û–Ω–∏ –ø–æ–∑–≤–æ–ª—è—é—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å —Ä–µ—Å—É—Ä—Å–∞–º–∏, —Ç–∞–∫–∏–º–∏ –∫–∞–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–∞–º –¥–∞–Ω–Ω—ã—Ö, –∫—ç—à–∏ –∏–ª–∏ –≤–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –¥–æ –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–∫—Ä—ã—Ç—ã –ø—Ä–∏ –µ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏.

---

### **–ö–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç lifespan —Å–æ–±—ã—Ç–∏—è?**

1. **–ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è**:
   - –ö–æ–¥, —É–∫–∞–∑–∞–Ω–Ω—ã–π –≤ lifespan, –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è **–¥–æ** —Ç–æ–≥–æ, –∫–∞–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞—á–Ω–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã.
   - –≠—Ç–æ –∏–¥–µ–∞–ª—å–Ω–æ–µ –º–µ—Å—Ç–æ –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Ä–µ—Å—É—Ä—Å–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö).

2. **–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è**:
   - –ö–æ–¥, —É–∫–∞–∑–∞–Ω–Ω—ã–π –≤ lifespan, –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è **–ø–æ—Å–ª–µ** –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
   - –≠—Ç–æ –∏–¥–µ–∞–ª—å–Ω–æ–µ –º–µ—Å—Ç–æ –¥–ª—è –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π).

---

### **–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å lifespan —Å–æ–±—ã—Ç–∏—è?**

Lifespan —Å–æ–±—ã—Ç–∏—è —Ä–µ–∞–ª–∏–∑—É—é—Ç—Å—è —Å –ø–æ–º–æ—â—å—é **–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–≥–æ –º–µ–Ω–µ–¥–∂–µ—Ä–∞**. –î–ª—è —ç—Ç–æ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ–±—ä–µ–∫—Ç `lifespan`, –∫–æ—Ç–æ—Ä—ã–π –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ `FastAPI`.

---

### **–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è**

#### 1. **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö**
```python
from fastapi import FastAPI
from sqlalchemy import create_engine
from sqlalchemy.orm import sessionmaker

# –°–æ–∑–¥–∞–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
DATABASE_URL = "sqlite:///./test.db"
engine = create_engine(DATABASE_URL)
SessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)

app = FastAPI()

# Lifespan —Å–æ–±—ã—Ç–∏—è
@app.on_event("startup")
async def startup():
    print("Starting up...")
    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö)
    app.state.db_engine = engine
    app.state.db_session = SessionLocal

@app.on_event("shutdown")
async def shutdown():
    print("Shutting down...")
    # –û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö)
    app.state.db_engine.dispose()

@app.get("/")
async def root():
    return {"message": "Hello, World!"}
```

- **–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç**:
  - –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è `startup`, –≥–¥–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.
  - –ü—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Ä–∞–±–æ—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è `shutdown`, –≥–¥–µ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ.

---

#### 2. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `lifespan` (–Ω–∞—á–∏–Ω–∞—è —Å FastAPI 0.95.0)**
–ù–∞—á–∏–Ω–∞—è —Å –≤–µ—Ä—Å–∏–∏ 0.95.0, —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–±—ä–µ–∫—Ç `lifespan` –≤–º–µ—Å—Ç–æ `@app.on_event`.

```python
from contextlib import asynccontextmanager
from fastapi import FastAPI
from sqlalchemy import create_engine
from sqlalchemy.orm import sessionmaker

# –°–æ–∑–¥–∞–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
DATABASE_URL = "sqlite:///./test.db"
engine = create_engine(DATABASE_URL)
SessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)

# Lifespan –º–µ–Ω–µ–¥–∂–µ—Ä
@asynccontextmanager
async def lifespan(app: FastAPI):
    # –ö–æ–¥, –≤—ã–ø–æ–ª–Ω—è–µ–º—ã–π –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
    print("Starting up...")
    app.state.db_engine = engine
    app.state.db_session = SessionLocal
    yield
    # –ö–æ–¥, –≤—ã–ø–æ–ª–Ω—è–µ–º—ã–π –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏
    print("Shutting down...")
    app.state.db_engine.dispose()

app = FastAPI(lifespan=lifespan)

@app.get("/")
async def root():
    return {"message": "Hello, World!"}
```

- **–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç**:
  - –ö–æ–¥ –¥–æ `yield` –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
  - –ö–æ–¥ –ø–æ—Å–ª–µ `yield` –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Ä–∞–±–æ—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

---

### **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è lifespan —Å–æ–±—ã—Ç–∏–π**
1. **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤**:
   - –ú–æ–∂–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–∞–º –¥–∞–Ω–Ω—ã—Ö, –∫—ç—à–∏, –≤–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã –∏ —Ç.–¥.
2. **–û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤**:
   - –ú–æ–∂–Ω–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–∫—Ä—ã—Ç—å —Ä–µ—Å—É—Ä—Å—ã –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Ä–∞–±–æ—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
3. **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**:
   - –í–µ—Å—å –∫–æ–¥, —Å–≤—è–∑–∞–Ω–Ω—ã–π —Å –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ.

---

### **–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å lifespan —Å–æ–±—ã—Ç–∏—è?**
- –î–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –∫ –±–∞–∑–∞–º –¥–∞–Ω–Ω—ã—Ö.
- –î–ª—è –∑–∞–ø—É—Å–∫–∞ –∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ñ–æ–Ω–æ–≤—ã—Ö –∑–∞–¥–∞—á.
- –î–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫—ç—à–µ–º –∏–ª–∏ –¥—Ä—É–≥–∏–º–∏ —Ä–µ—Å—É—Ä—Å–∞–º–∏.

---

### **–ò—Ç–æ–≥**
- **Lifespan —Å–æ–±—ã—Ç–∏—è** –ø–æ–∑–≤–æ–ª—è—é—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –∫–æ–¥ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Ä–∞–±–æ—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
- –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `@app.on_event("startup")` –∏ `@app.on_event("shutdown")` –∏–ª–∏ –æ–±—ä–µ–∫—Ç `lifespan`.
- –≠—Ç–æ –∏–¥–µ–∞–ª—å–Ω–æ–µ –º–µ—Å—Ç–æ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–∞–º–∏, —Ç–∞–∫–∏–º–∏ –∫–∞–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–∞–º –¥–∞–Ω–Ω—ã—Ö.

–ü—Ä–∏–º–µ—Ä —Å `lifespan`:

```python
from contextlib import asynccontextmanager
from fastapi import FastAPI
from sqlalchemy import create_engine
from sqlalchemy.orm import sessionmaker

DATABASE_URL = "sqlite:///./test.db"
engine = create_engine(DATABASE_URL)
SessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)

@asynccontextmanager
async def lifespan(app: FastAPI):
    print("Starting up...")
    app.state.db_engine = engine
    app.state.db_session = SessionLocal
    yield
    print("Shutting down...")
    app.state.db_engine.dispose()

app = FastAPI(lifespan=lifespan)

@app.get("/")
async def root():
    return {"message": "Hello, World!"}
```



## 30. –í —á–µ–º —Ä–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É lifespan –∏ —Å–æ–±—ã—Ç–∏—è–º–∏ startup –∏ shutdown?
|**–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞**|**`startup`¬†–∏¬†`shutdown`**|**Lifespan**|
|---|---|---|
|**–°–∏–Ω—Ç–∞–∫—Å–∏—Å**|–î–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã¬†`@app.on_event`.|–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä (`yield`).|
|**–ì–∏–±–∫–æ—Å—Ç—å**|–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∞.|–í—ã—Å–æ–∫–∞—è (–º–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ).|
|**–ü–æ–¥–¥–µ—Ä–∂–∫–∞**|–£—Å—Ç–∞—Ä–µ–≤—à–∏–π –ø–æ–¥—Ö–æ–¥ (–Ω–æ –≤—Å–µ –µ—â–µ —Ä–∞–±–æ—Ç–∞–µ—Ç).|–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –ø–æ–¥—Ö–æ–¥ (–Ω–∞—á–∏–Ω–∞—è —Å FastAPI 0.95.0).|
|**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**|–ü—Ä–æ—Å—Ç—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏.|–°–ª–æ–∂–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–µ—Å—É—Ä—Å–æ–≤).|

---

### **–ö–æ–≥–¥–∞ —á—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å?**

## 31. –ö–∞–∫ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Ä–µ—Å—É—Ä—Å—ã –∏ –∏—Ö –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –≤ —Ä–∞–º–∫–∞—Ö lifespan –≤ FastAPI?
–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤ –∏ –∏—Ö –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –≤ —Ä–∞–º–∫–∞—Ö **lifespan** –≤ FastAPI ‚Äî —ç—Ç–æ –≤–∞–∂–Ω–∞—è —á–∞—Å—Ç—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. Lifespan –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–µ—Å—É—Ä—Å—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–∞–º –¥–∞–Ω–Ω—ã—Ö, –∫—ç—à–∏, –≤–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã) –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Å–≤–æ–±–æ–∂–¥–∞—Ç—å –∏—Ö –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Ä–∞–±–æ—Ç—ã.

---

### **–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?**

1. **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤**:
   - –ö–æ–¥ –¥–æ `yield` –≤ lifespan –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–∏ **–∑–∞–ø—É—Å–∫–µ** –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
   - –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–µ—Å—É—Ä—Å—ã, —Ç–∞–∫–∏–µ –∫–∞–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–∞–º –¥–∞–Ω–Ω—ã—Ö, –∫—ç—à–∏, –ø—É–ª—ã –ø–æ—Ç–æ–∫–æ–≤ –∏ —Ç.–¥.

2. **–û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤**:
   - –ö–æ–¥ –ø–æ—Å–ª–µ `yield` –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–∏ **–∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏** —Ä–∞–±–æ—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
   - –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –∑–∞–∫—Ä—ã—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è, –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ñ–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏, –æ—Å–≤–æ–±–æ–¥–∏—Ç—å –ø–∞–º—è—Ç—å –∏ —Ç.–¥.

---

### **–ü—Ä–∏–º–µ—Ä—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ä–µ—Å—É—Ä—Å–æ–≤**

#### 1. **–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö**
–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º SQLAlchemy.

```python
from contextlib import asynccontextmanager
from fastapi import FastAPI
from sqlalchemy import create_engine
from sqlalchemy.orm import sessionmaker

# –°–æ–∑–¥–∞–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
DATABASE_URL = "sqlite:///./test.db"
engine = create_engine(DATABASE_URL)
SessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)

# Lifespan –º–µ–Ω–µ–¥–∂–µ—Ä
@asynccontextmanager
async def lifespan(app: FastAPI):
    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
    print("Starting up...")
    app.state.db_engine = engine
    app.state.db_session = SessionLocal
    yield

    print("Shutting down...")
    app.state.db_engine.dispose()

app = FastAPI(lifespan=lifespan)

@app.get("/")
async def root():
    return {"message": "Hello, World!"}
```

- **–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç**:
  - –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å–æ–∑–¥–∞–µ—Ç—Å—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `app.state`.
  - –ü—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Ä–∞–±–æ—Ç—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è —Å –ø–æ–º–æ—â—å—é `engine.dispose()`.

---

#### 2. **–ö—ç—à –≤ –ø–∞–º—è—Ç–∏**
–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ –æ—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞ –≤ –ø–∞–º—è—Ç–∏.

```python
from contextlib import asynccontextmanager
from fastapi import FastAPI

# Lifespan –º–µ–Ω–µ–¥–∂–µ—Ä
@asynccontextmanager
async def lifespan(app: FastAPI):
    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫—ç—à–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
    print("Starting up...")
    app.state.cache = {}
    yield
    # –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏
    print("Shutting down...")
    app.state.cache.clear()

app = FastAPI(lifespan=lifespan)

@app.get("/cache/")
async def get_cache():
    return {"cache": app.state.cache}
```

- **–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç**:
  - –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å–æ–∑–¥–∞–µ—Ç—Å—è –∫—ç—à –≤ –ø–∞–º—è—Ç–∏.
  - –ü—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Ä–∞–±–æ—Ç—ã –∫—ç—à –æ—á–∏—â–∞–µ—Ç—Å—è.

---

#### 3. **–§–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏**
–ó–∞–ø—É—Å–∫ –∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ñ–æ–Ω–æ–≤—ã—Ö –∑–∞–¥–∞—á.

```python
from contextlib import asynccontextmanager
from fastapi import FastAPI
import asyncio

# Lifespan –º–µ–Ω–µ–¥–∂–µ—Ä
@asynccontextmanager
async def lifespan(app: FastAPI):
    # –ó–∞–ø—É—Å–∫ —Ñ–æ–Ω–æ–≤–æ–π –∑–∞–¥–∞—á–∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
    print("Starting up...")
    task = asyncio.create_task(background_task())
    yield
    # –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ñ–æ–Ω–æ–≤–æ–π –∑–∞–¥–∞—á–∏ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏
    print("Shutting down...")
    task.cancel()
    try:
        await task
    except asyncio.CancelledError:
        print("Background task cancelled")

async def background_task():
    while True:
        print("Background task is running...")
        await asyncio.sleep(5)

app = FastAPI(lifespan=lifespan)

@app.get("/")
async def root():
    return {"message": "Hello, World!"}
```

- **–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç**:
  - –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å–æ–∑–¥–∞–µ—Ç—Å—è —Ñ–æ–Ω–æ–≤–∞—è –∑–∞–¥–∞—á–∞, –∫–æ—Ç–æ—Ä–∞—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥.
  - –ü—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Ä–∞–±–æ—Ç—ã –∑–∞–¥–∞—á–∞ –æ—Ç–º–µ–Ω—è–µ—Ç—Å—è.

---

#### 4. **–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –≤–Ω–µ—à–Ω–µ–º—É —Å–µ—Ä–≤–∏—Å—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, Redis)**
–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Redis.

```python
from contextlib import asynccontextmanager
from fastapi import FastAPI
import redis

# Lifespan –º–µ–Ω–µ–¥–∂–µ—Ä
@asynccontextmanager
async def lifespan(app: FastAPI):
    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Redis –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
    print("Starting up...")
    app.state.redis = redis.Redis(host="localhost", port=6379, db=0)
    yield
    # –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Redis –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏
    print("Shutting down...")
    app.state.redis.close()

app = FastAPI(lifespan=lifespan)

@app.get("/redis/")
async def get_redis(key: str):
    value = app.state.redis.get(key)
    return {"key": key, "value": value}
```

- **–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç**:
  - –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å–æ–∑–¥–∞–µ—Ç—Å—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Redis.
  - –ü—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Ä–∞–±–æ—Ç—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è.

---

### **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è lifespan –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–∞–º–∏**
1. **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**:
   - –í–µ—Å—å –∫–æ–¥, —Å–≤—è–∑–∞–Ω–Ω—ã–π —Å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π –∏ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ–º —Ä–µ—Å—É—Ä—Å–æ–≤, –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ.
2. **–ì–∏–±–∫–æ—Å—Ç—å**:
   - –ú–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –º–µ–∂–¥—É –∫–æ–¥–æ–º –∑–∞–ø—É—Å–∫–∞ –∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è.
3. **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å**:
   - –†–µ—Å—É—Ä—Å—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Å–≤–æ–±–æ–∂–¥–∞—é—Ç—Å—è –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Ä–∞–±–æ—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

---

### **–ò—Ç–æ–≥**
- **Lifespan** ‚Äî —ç—Ç–æ –º–æ—â–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–∞–º–∏ –≤ FastAPI.
- –ò—Å–ø–æ–ª—å–∑—É–π –∫–æ–¥ –¥–æ `yield` –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Ä–µ—Å—É—Ä—Å–æ–≤.
- –ò—Å–ø–æ–ª—å–∑—É–π –∫–æ–¥ –ø–æ—Å–ª–µ `yield` –¥–ª—è –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤.

–ü—Ä–∏–º–µ—Ä —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö:

```python
from contextlib import asynccontextmanager
from fastapi import FastAPI
from sqlalchemy import create_engine
from sqlalchemy.orm import sessionmaker

DATABASE_URL = "sqlite:///./test.db"
engine = create_engine(DATABASE_URL)
SessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)

@asynccontextmanager
async def lifespan(app: FastAPI):
    print("Starting up...")
    app.state.db_engine = engine
    app.state.db_session = SessionLocal
    yield
    print("Shutting down...")
    app.state.db_engine.dispose()

app = FastAPI(lifespan=lifespan)

@app.get("/")
async def root():
    return {"message": "Hello, World!"}
```

